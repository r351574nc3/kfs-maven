<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>BudgetConstructionSalarySummaryReportDaoJdbc xref</title>
<link type="text/css" rel="stylesheet" href="../../../../../../../../stylesheet.css" />
</head>
<body>
<div id="overview"><a href="../../../../../../../../../apidocs/org/kuali/kfs/module/bc/document/dataaccess/impl/BudgetConstructionSalarySummaryReportDaoJdbc.html">View Javadoc</a></div><pre>

<a class="jxr_linenumber" name="1" href="#1">1</a>   <em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="2" href="#2">2</a>   <em class="jxr_comment"> * Copyright 2011 The Kuali Foundation.</em>
<a class="jxr_linenumber" name="3" href="#3">3</a>   <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="4" href="#4">4</a>   <em class="jxr_comment"> * Licensed under the Educational Community License, Version 2.0 (the "License");</em>
<a class="jxr_linenumber" name="5" href="#5">5</a>   <em class="jxr_comment"> * you may not use this file except in compliance with the License.</em>
<a class="jxr_linenumber" name="6" href="#6">6</a>   <em class="jxr_comment"> * You may obtain a copy of the License at</em>
<a class="jxr_linenumber" name="7" href="#7">7</a>   <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="8" href="#8">8</a>   <em class="jxr_comment"> * <a href="http://www.opensource.org/licenses/ecl2.php" target="alexandria_uri">http://www.opensource.org/licenses/ecl2.php</a></em>
<a class="jxr_linenumber" name="9" href="#9">9</a>   <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="10" href="#10">10</a>  <em class="jxr_comment"> * Unless required by applicable law or agreed to in writing, software</em>
<a class="jxr_linenumber" name="11" href="#11">11</a>  <em class="jxr_comment"> * distributed under the License is distributed on an "AS IS" BASIS,</em>
<a class="jxr_linenumber" name="12" href="#12">12</a>  <em class="jxr_comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</em>
<a class="jxr_linenumber" name="13" href="#13">13</a>  <em class="jxr_comment"> * See the License for the specific language governing permissions and</em>
<a class="jxr_linenumber" name="14" href="#14">14</a>  <em class="jxr_comment"> * limitations under the License.</em>
<a class="jxr_linenumber" name="15" href="#15">15</a>  <em class="jxr_comment"> */</em>
<a class="jxr_linenumber" name="16" href="#16">16</a>  <strong class="jxr_keyword">package</strong> org.kuali.kfs.module.bc.document.dataaccess.impl;
<a class="jxr_linenumber" name="17" href="#17">17</a>  
<a class="jxr_linenumber" name="18" href="#18">18</a>  <strong class="jxr_keyword">import</strong> java.math.BigDecimal;
<a class="jxr_linenumber" name="19" href="#19">19</a>  <strong class="jxr_keyword">import</strong> java.util.ArrayList;
<a class="jxr_linenumber" name="20" href="#20">20</a>  
<a class="jxr_linenumber" name="21" href="#21">21</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.module.bc.BCConstants;
<a class="jxr_linenumber" name="22" href="#22">22</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.module.bc.batch.dataaccess.impl.SQLForStep;
<a class="jxr_linenumber" name="23" href="#23">23</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.module.bc.document.dataaccess.BudgetConstructionSalarySummaryReportDao;
<a class="jxr_linenumber" name="24" href="#24">24</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kns.service.PersistenceService;
<a class="jxr_linenumber" name="25" href="#25">25</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kns.util.Guid;
<a class="jxr_linenumber" name="26" href="#26">26</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kns.util.KualiDecimal;
<a class="jxr_linenumber" name="27" href="#27">27</a>  
<a class="jxr_linenumber" name="28" href="#28">28</a>  <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="29" href="#29">29</a>  <em class="jxr_javadoccomment"> * builds the underlying data table for the salary summary report in budget construction</em>
<a class="jxr_linenumber" name="30" href="#30">30</a>  <em class="jxr_javadoccomment"> */</em>
<a class="jxr_linenumber" name="31" href="#31">31</a>  
<a class="jxr_linenumber" name="32" href="#32">32</a>  <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">class</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/document/dataaccess/impl/BudgetConstructionSalarySummaryReportDaoJdbc.html">BudgetConstructionSalarySummaryReportDaoJdbc</a> <strong class="jxr_keyword">extends</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/document/dataaccess/impl/BudgetConstructionDaoJdbcBase.html">BudgetConstructionDaoJdbcBase</a> <strong class="jxr_keyword">implements</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/document/dataaccess/BudgetConstructionSalarySummaryReportDao.html">BudgetConstructionSalarySummaryReportDao</a> {
<a class="jxr_linenumber" name="33" href="#33">33</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(BudgetConstructionSalarySummaryReportDaoJdbc.<strong class="jxr_keyword">class</strong>);
<a class="jxr_linenumber" name="34" href="#34">34</a>  
<a class="jxr_linenumber" name="35" href="#35">35</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> ArrayList&lt;SQLForStep&gt; updateReportsSalarySummaryThreshold           = <strong class="jxr_keyword">new</strong> ArrayList&lt;SQLForStep&gt;(7);
<a class="jxr_linenumber" name="36" href="#36">36</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> ArrayList&lt;SQLForStep&gt; salarySummaryAboveThreshold                   = <strong class="jxr_keyword">new</strong> ArrayList&lt;SQLForStep&gt;(1);
<a class="jxr_linenumber" name="37" href="#37">37</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> ArrayList&lt;SQLForStep&gt; salarySummaryBelowThreshold                   = <strong class="jxr_keyword">new</strong> ArrayList&lt;SQLForStep&gt;(1);
<a class="jxr_linenumber" name="38" href="#38">38</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> ArrayList&lt;SQLForStep&gt; updateReportsSalarySummaryNoThresholdReason   = <strong class="jxr_keyword">new</strong> ArrayList&lt;SQLForStep&gt;(1);
<a class="jxr_linenumber" name="39" href="#39">39</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> ArrayList&lt;SQLForStep&gt; updateReportsSalarySummaryNoThresholdNoReason = <strong class="jxr_keyword">new</strong> ArrayList&lt;SQLForStep&gt;(1);
<a class="jxr_linenumber" name="40" href="#40">40</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> ArrayList&lt;SQLForStep&gt; updateReportsSalarySummaryCommon              = <strong class="jxr_keyword">new</strong> ArrayList&lt;SQLForStep&gt;(2);
<a class="jxr_linenumber" name="41" href="#41">41</a>      
<a class="jxr_linenumber" name="42" href="#42">42</a>      <strong class="jxr_keyword">private</strong> PersistenceService persistenceService;
<a class="jxr_linenumber" name="43" href="#43">43</a>  
<a class="jxr_linenumber" name="44" href="#44">44</a>      <strong class="jxr_keyword">public</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/document/dataaccess/impl/BudgetConstructionSalarySummaryReportDaoJdbc.html">BudgetConstructionSalarySummaryReportDaoJdbc</a>() {
<a class="jxr_linenumber" name="45" href="#45">45</a>  
<a class="jxr_linenumber" name="46" href="#46">46</a>          <em class="jxr_comment">// builds and updates SalarySummaryReports</em>
<a class="jxr_linenumber" name="47" href="#47">47</a>          
<a class="jxr_linenumber" name="48" href="#48">48</a>          ArrayList&lt;Integer&gt; insertionPoints = <strong class="jxr_keyword">new</strong> ArrayList&lt;Integer&gt;(10);
<a class="jxr_linenumber" name="49" href="#49">49</a>          StringBuilder sqlText = <strong class="jxr_keyword">new</strong> StringBuilder(1500);
<a class="jxr_linenumber" name="50" href="#50">50</a>  
<a class="jxr_linenumber" name="51" href="#51">51</a>          <em class="jxr_comment">/*<em class="jxr_comment"> get no leave bcaf, bcsf and posn info first */</em></em>
<a class="jxr_linenumber" name="52" href="#52">52</a>          sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_BUILD_SALSUMM01_MT \n"</span>);
<a class="jxr_linenumber" name="53" href="#53">53</a>          sqlText.append(<span class="jxr_string">" (SESID, EMPLID, POSITION_NBR, SAL_AMT, SAL_PCT, SAL_MTHS, POS_CSF_AMT, POS_CSF_TM_PCT, SAL_PMTHS) \n"</span>);
<a class="jxr_linenumber" name="54" href="#54">54</a>          sqlText.append(<span class="jxr_string">"SELECT ?, bcaf.emplid, bcaf.position_nbr,  bcaf.appt_rqst_amt, bcaf.appt_rqst_tm_pct, bcaf.appt_fnd_mo, bcsf.pos_csf_amt, bcsf.pos_csf_tm_pct, posn.iu_pay_months \n"</span>);
<a class="jxr_linenumber" name="55" href="#55">55</a>          sqlText.append(<span class="jxr_string">"FROM (LD_PNDBC_APPTFND_T bcaf LEFT OUTER JOIN LD_BCN_CSF_TRCKR_T bcsf \n"</span>);
<a class="jxr_linenumber" name="56" href="#56">56</a>          sqlText.append(<span class="jxr_string">" ON ((bcaf.fin_coa_cd = bcsf.fin_coa_cd) AND (bcaf.account_nbr = bcsf.account_nbr) \n"</span>);
<a class="jxr_linenumber" name="57" href="#57">57</a>          sqlText.append(<span class="jxr_string">" AND(bcaf.sub_acct_nbr = bcsf.sub_acct_nbr) AND (bcaf.fin_object_cd = bcsf.fin_object_cd) \n"</span>);
<a class="jxr_linenumber" name="58" href="#58">58</a>          sqlText.append(<span class="jxr_string">" AND(bcaf.fin_sub_obj_cd = bcsf.fin_sub_obj_cd) AND (bcaf.position_nbr = bcsf.position_nbr)\n"</span>);
<a class="jxr_linenumber" name="59" href="#59">59</a>          sqlText.append(<span class="jxr_string">" AND(bcaf.emplid = bcsf.emplid) AND (bcaf.univ_fiscal_yr= bcsf.univ_fiscal_yr))),\n"</span>);
<a class="jxr_linenumber" name="60" href="#60">60</a>          sqlText.append(<span class="jxr_string">"      LD_BCN_POS_T posn, LD_BCN_CTRL_LIST_T ctrl, LD_BCN_OBJ_PICK_T pick\n"</span>);
<a class="jxr_linenumber" name="61" href="#61">61</a>          sqlText.append(<span class="jxr_string">"WHERE ctrl.person_unvl_id = ? \n"</span>);
<a class="jxr_linenumber" name="62" href="#62">62</a>          sqlText.append(<span class="jxr_string">" AND bcaf.univ_fiscal_yr = ctrl.univ_fiscal_yr \n"</span>);
<a class="jxr_linenumber" name="63" href="#63">63</a>          sqlText.append(<span class="jxr_string">" AND bcaf.fin_coa_cd = ctrl.fin_coa_cd \n"</span>);
<a class="jxr_linenumber" name="64" href="#64">64</a>          sqlText.append(<span class="jxr_string">" AND bcaf.account_nbr = ctrl.account_nbr \n"</span>);
<a class="jxr_linenumber" name="65" href="#65">65</a>          sqlText.append(<span class="jxr_string">" AND bcaf.sub_acct_nbr = ctrl.sub_acct_nbr \n"</span>);
<a class="jxr_linenumber" name="66" href="#66">66</a>          sqlText.append(<span class="jxr_string">" AND bcaf.emplid &lt;&gt; '"</span>);
<a class="jxr_linenumber" name="67" href="#67">67</a>          <em class="jxr_comment">//  empolyee ID for a vacant line in budget construction CSF and appointment funding</em>
<a class="jxr_linenumber" name="68" href="#68">68</a>          insertionPoints.add(sqlText.length());
<a class="jxr_linenumber" name="69" href="#69">69</a>          sqlText.append(<span class="jxr_string">"' \n"</span>);
<a class="jxr_linenumber" name="70" href="#70">70</a>          sqlText.append(<span class="jxr_string">" AND bcaf.appt_fnd_dur_cd = '"</span>);
<a class="jxr_linenumber" name="71" href="#71">71</a>          <em class="jxr_comment">// default appointment funding duration code</em>
<a class="jxr_linenumber" name="72" href="#72">72</a>          insertionPoints.add(sqlText.length());
<a class="jxr_linenumber" name="73" href="#73">73</a>          sqlText.append(<span class="jxr_string">"' \n"</span>);
<a class="jxr_linenumber" name="74" href="#74">74</a>          sqlText.append(<span class="jxr_string">" AND bcaf.fin_object_cd = pick.fin_object_cd \n"</span>);
<a class="jxr_linenumber" name="75" href="#75">75</a>          sqlText.append(<span class="jxr_string">" AND pick.person_unvl_id = ctrl.person_unvl_id \n"</span>);
<a class="jxr_linenumber" name="76" href="#76">76</a>          sqlText.append(<span class="jxr_string">" AND pick.select_flag &gt; 0 \n"</span>);
<a class="jxr_linenumber" name="77" href="#77">77</a>          sqlText.append(<span class="jxr_string">" AND bcaf.univ_fiscal_yr = posn.univ_fiscal_yr \n"</span>);
<a class="jxr_linenumber" name="78" href="#78">78</a>          sqlText.append(<span class="jxr_string">" AND bcaf.position_nbr = posn.position_nbr \n"</span>);
<a class="jxr_linenumber" name="79" href="#79">79</a>  
<a class="jxr_linenumber" name="80" href="#80">80</a>          updateReportsSalarySummaryThreshold.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText,insertionPoints));
<a class="jxr_linenumber" name="81" href="#81">81</a>          sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="82" href="#82">82</a>          insertionPoints.clear();
<a class="jxr_linenumber" name="83" href="#83">83</a>  
<a class="jxr_linenumber" name="84" href="#84">84</a>          <em class="jxr_comment">/*<em class="jxr_comment"> get leave flagged bcaf, bcsf and posn info first */</em></em>
<a class="jxr_linenumber" name="85" href="#85">85</a>          <em class="jxr_comment">/*<em class="jxr_comment"> uses leave related info from bcaf, etc */</em></em>
<a class="jxr_linenumber" name="86" href="#86">86</a>          sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_BUILD_SALSUMM01_MT \n"</span>);
<a class="jxr_linenumber" name="87" href="#87">87</a>          sqlText.append(<span class="jxr_string">"(SESID, EMPLID, POSITION_NBR, SAL_AMT, SAL_PCT, SAL_MTHS, \n"</span>);
<a class="jxr_linenumber" name="88" href="#88">88</a>          sqlText.append(<span class="jxr_string">" POS_CSF_AMT, POS_CSF_TM_PCT, SAL_PMTHS) \n"</span>);
<a class="jxr_linenumber" name="89" href="#89">89</a>          sqlText.append(<span class="jxr_string">"SELECT ?, bcaf.emplid, bcaf.position_nbr, bcaf.appt_rqst_csf_amt, bcaf.appt_rqcsf_tm_pct, posn.iu_norm_work_months, \n"</span>);
<a class="jxr_linenumber" name="90" href="#90">90</a>          sqlText.append(<span class="jxr_string">"  bcsf.pos_csf_amt, bcsf.pos_csf_tm_pct, posn.iu_pay_months \n"</span>);
<a class="jxr_linenumber" name="91" href="#91">91</a>          sqlText.append(<span class="jxr_string">"FROM (LD_PNDBC_APPTFND_T bcaf LEFT OUTER JOIN LD_BCN_CSF_TRCKR_T bcsf \n"</span>);
<a class="jxr_linenumber" name="92" href="#92">92</a>          sqlText.append(<span class="jxr_string">" ON ((bcaf.fin_coa_cd = bcsf.fin_coa_cd) AND (bcaf.account_nbr = bcsf.account_nbr) \n"</span>);
<a class="jxr_linenumber" name="93" href="#93">93</a>          sqlText.append(<span class="jxr_string">"AND (bcaf.sub_acct_nbr = bcsf.sub_acct_nbr) AND (bcaf.fin_object_cd = bcsf.fin_object_cd) \n"</span>);
<a class="jxr_linenumber" name="94" href="#94">94</a>          sqlText.append(<span class="jxr_string">"AND (bcaf.fin_sub_obj_cd = bcsf.fin_sub_obj_cd) AND (bcaf.position_nbr = bcsf.position_nbr) \n"</span>);
<a class="jxr_linenumber" name="95" href="#95">95</a>          sqlText.append(<span class="jxr_string">"AND (bcaf.emplid = bcsf.emplid) AND (bcaf.univ_fiscal_yr= bcsf.univ_fiscal_yr))), LD_BCN_POS_T posn, LD_BCN_CTRL_LIST_T ctrl, LD_BCN_OBJ_PICK_T pick \n"</span>);
<a class="jxr_linenumber" name="96" href="#96">96</a>          sqlText.append(<span class="jxr_string">"WHERE ctrl.person_unvl_id = ? \n"</span>);
<a class="jxr_linenumber" name="97" href="#97">97</a>          sqlText.append(<span class="jxr_string">" AND bcaf.univ_fiscal_yr = ctrl.univ_fiscal_yr \n"</span>);
<a class="jxr_linenumber" name="98" href="#98">98</a>          sqlText.append(<span class="jxr_string">" AND bcaf.fin_coa_cd = ctrl.fin_coa_cd \n"</span>);
<a class="jxr_linenumber" name="99" href="#99">99</a>          sqlText.append(<span class="jxr_string">" AND bcaf.account_nbr = ctrl.account_nbr \n"</span>);
<a class="jxr_linenumber" name="100" href="#100">100</a>         sqlText.append(<span class="jxr_string">" AND bcaf.sub_acct_nbr = ctrl.sub_acct_nbr \n"</span>);
<a class="jxr_linenumber" name="101" href="#101">101</a>         sqlText.append(<span class="jxr_string">" AND bcaf.emplid &lt;&gt; '\n"</span>);
<a class="jxr_linenumber" name="102" href="#102">102</a>         <em class="jxr_comment">//  empolyee ID for a vacant line in budget construction CSF and appointment funding</em>
<a class="jxr_linenumber" name="103" href="#103">103</a>         insertionPoints.add(sqlText.length());
<a class="jxr_linenumber" name="104" href="#104">104</a>         sqlText.append(<span class="jxr_string">"' \n"</span>);
<a class="jxr_linenumber" name="105" href="#105">105</a>         sqlText.append(<span class="jxr_string">" AND bcaf.appt_fnd_dur_cd &lt;&gt; '"</span>);
<a class="jxr_linenumber" name="106" href="#106">106</a>         <em class="jxr_comment">// defualt appointment funding duration code</em>
<a class="jxr_linenumber" name="107" href="#107">107</a>         insertionPoints.add(sqlText.length());
<a class="jxr_linenumber" name="108" href="#108">108</a>         sqlText.append(<span class="jxr_string">"' \n"</span>);
<a class="jxr_linenumber" name="109" href="#109">109</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_object_cd = pick.fin_object_cd \n"</span>);
<a class="jxr_linenumber" name="110" href="#110">110</a>         sqlText.append(<span class="jxr_string">" AND pick.person_unvl_id = ctrl.person_unvl_id \n"</span>);
<a class="jxr_linenumber" name="111" href="#111">111</a>         sqlText.append(<span class="jxr_string">" AND pick.select_flag &gt; 0 \n"</span>);
<a class="jxr_linenumber" name="112" href="#112">112</a>         sqlText.append(<span class="jxr_string">" AND bcaf.univ_fiscal_yr = posn.univ_fiscal_yr \n"</span>);
<a class="jxr_linenumber" name="113" href="#113">113</a>         sqlText.append(<span class="jxr_string">" AND bcaf.position_nbr = posn.position_nbr \n"</span>);
<a class="jxr_linenumber" name="114" href="#114">114</a> 
<a class="jxr_linenumber" name="115" href="#115">115</a>         updateReportsSalarySummaryThreshold.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText,insertionPoints));
<a class="jxr_linenumber" name="116" href="#116">116</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="117" href="#117">117</a>         insertionPoints.clear();
<a class="jxr_linenumber" name="118" href="#118">118</a> 
<a class="jxr_linenumber" name="119" href="#119">119</a>         <em class="jxr_comment">/*<em class="jxr_comment"> for each emplid, find the record with the largest salary (break ties by taking the row with the smallest position number) */</em></em>
<a class="jxr_linenumber" name="120" href="#120">120</a>         sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_BUILD_SALSUMM02_MT \n"</span>);
<a class="jxr_linenumber" name="121" href="#121">121</a>         sqlText.append(<span class="jxr_string">"(SESID, EMPLID, SAL_MTHS, SAL_PMTHS) \n"</span>);
<a class="jxr_linenumber" name="122" href="#122">122</a>         sqlText.append(<span class="jxr_string">"SELECT DISTINCT ?, sd.emplid, sd.sal_mths, sd.sal_pmths \n"</span>);
<a class="jxr_linenumber" name="123" href="#123">123</a>         sqlText.append(<span class="jxr_string">"FROM LD_BCN_BUILD_SALSUMM01_MT sd \n"</span>);
<a class="jxr_linenumber" name="124" href="#124">124</a>         sqlText.append(<span class="jxr_string">"WHERE sesid = ? \n"</span>);
<a class="jxr_linenumber" name="125" href="#125">125</a>         sqlText.append(<span class="jxr_string">"AND sd.sal_amt = (SELECT max(sd2.sal_amt) \n"</span>);
<a class="jxr_linenumber" name="126" href="#126">126</a>         sqlText.append(<span class="jxr_string">"                  FROM LD_BCN_BUILD_SALSUMM01_MT sd2\n"</span>);
<a class="jxr_linenumber" name="127" href="#127">127</a>         sqlText.append(<span class="jxr_string">"                  WHERE sd2.sesid = sd.sesid AND sd2.emplid = sd.emplid)\n"</span>);
<a class="jxr_linenumber" name="128" href="#128">128</a>         sqlText.append(<span class="jxr_string">"AND sd.position_nbr = (SELECT min(sd3.position_nbr) \n"</span>);
<a class="jxr_linenumber" name="129" href="#129">129</a>         sqlText.append(<span class="jxr_string">"                       FROM LD_BCN_BUILD_SALSUMM01_MT sd3\n"</span>);
<a class="jxr_linenumber" name="130" href="#130">130</a>         sqlText.append(<span class="jxr_string">"                       WHERE sd3.sesid = sd.sesid  \n"</span>);
<a class="jxr_linenumber" name="131" href="#131">131</a>         sqlText.append(<span class="jxr_string">"                         AND sd3.emplid = sd.emplid AND sd3.sal_amt = sd.sal_amt) \n"</span>);
<a class="jxr_linenumber" name="132" href="#132">132</a> 
<a class="jxr_linenumber" name="133" href="#133">133</a>         updateReportsSalarySummaryThreshold.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText));
<a class="jxr_linenumber" name="134" href="#134">134</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="135" href="#135">135</a> 
<a class="jxr_linenumber" name="136" href="#136">136</a>         <em class="jxr_comment">/*<em class="jxr_comment"> for each emplid, find the CSF from the previous year with the largest salary (break ties by taking the row with the smallest position number */</em></em>
<a class="jxr_linenumber" name="137" href="#137">137</a>         sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_BUILD_SALSUMM03_MT\n"</span>);
<a class="jxr_linenumber" name="138" href="#138">138</a>         sqlText.append(<span class="jxr_string">"(SESID, EMPLID, CSF_MTHS, CSF_PMTHS) \n"</span>);
<a class="jxr_linenumber" name="139" href="#139">139</a>         sqlText.append(<span class="jxr_string">"SELECT DISTINCT ?, sd.emplid, p.iu_norm_work_months, p.iu_pay_months \n"</span>);
<a class="jxr_linenumber" name="140" href="#140">140</a>         sqlText.append(<span class="jxr_string">"FROM LD_BCN_BUILD_SALSUMM01_MT sd, LD_BCN_POS_T p \n"</span>);
<a class="jxr_linenumber" name="141" href="#141">141</a>         sqlText.append(<span class="jxr_string">"WHERE sesid = ? \n"</span>);
<a class="jxr_linenumber" name="142" href="#142">142</a>         sqlText.append(<span class="jxr_string">" AND sd.pos_csf_amt = (SELECT max(sd2.pos_csf_amt)  \n"</span>);
<a class="jxr_linenumber" name="143" href="#143">143</a>         sqlText.append(<span class="jxr_string">"                       FROM LD_BCN_BUILD_SALSUMM01_MT sd2\n"</span>);
<a class="jxr_linenumber" name="144" href="#144">144</a>         sqlText.append(<span class="jxr_string">"                       WHERE sd2.sesid = sd.sesid AND sd2.emplid = sd.emplid) \n"</span>);
<a class="jxr_linenumber" name="145" href="#145">145</a>         sqlText.append(<span class="jxr_string">" AND sd.position_nbr = (SELECT min(sd3.position_nbr) \n"</span>);
<a class="jxr_linenumber" name="146" href="#146">146</a>         sqlText.append(<span class="jxr_string">"                        FROM LD_BCN_BUILD_SALSUMM01_MT sd3\n"</span>);
<a class="jxr_linenumber" name="147" href="#147">147</a>         sqlText.append(<span class="jxr_string">"                        WHERE sd3.sesid = sd.sesid AND sd3.emplid = sd.emplid AND sd3.pos_csf_amt = sd.pos_csf_amt) \n"</span>);
<a class="jxr_linenumber" name="148" href="#148">148</a>         sqlText.append(<span class="jxr_string">" AND p.univ_fiscal_yr = ? AND p.position_nbr = sd.position_nbr \n"</span>);
<a class="jxr_linenumber" name="149" href="#149">149</a> 
<a class="jxr_linenumber" name="150" href="#150">150</a>         updateReportsSalarySummaryThreshold.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText));
<a class="jxr_linenumber" name="151" href="#151">151</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="152" href="#152">152</a> 
<a class="jxr_linenumber" name="153" href="#153">153</a>         <em class="jxr_comment">/*<em class="jxr_comment"> merge the sal max,csf max info and sums to one table */</em></em>
<a class="jxr_linenumber" name="154" href="#154">154</a>         sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_BUILD_SALSUMM04_MT \n"</span>);
<a class="jxr_linenumber" name="155" href="#155">155</a>         sqlText.append(<span class="jxr_string">"(SESID, EMPLID, POS_CSF_AMT, RES_CSF_AMT, POS_CSF_TM_PCT, \n"</span>);
<a class="jxr_linenumber" name="156" href="#156">156</a>         sqlText.append(<span class="jxr_string">" SAL_AMT, SAL_PCT, SAL_MTHS, SAL_PMTHS, CSF_MTHS, CSF_PMTHS) \n"</span>);
<a class="jxr_linenumber" name="157" href="#157">157</a>         sqlText.append(<span class="jxr_string">"SELECT ?, sm.emplid, SUM(COALESCE(sd.pos_csf_amt,0)), 0, SUM(COALESCE(sd.pos_csf_tm_pct,0)), \n"</span>);
<a class="jxr_linenumber" name="158" href="#158">158</a>         sqlText.append(<span class="jxr_string">" SUM(COALESCE(sd.sal_amt,0)), SUM(COALESCE(sd.sal_pct,0)), sm.sal_mths, sm.sal_pmths, COALESCE(cm.csf_mths,0), COALESCE(cm.csf_pmths,0) \n"</span>);
<a class="jxr_linenumber" name="159" href="#159">159</a>         sqlText.append(<span class="jxr_string">"FROM (LD_BCN_BUILD_SALSUMM02_MT sm LEFT OUTER JOIN LD_BCN_BUILD_SALSUMM03_MT cm \n"</span>);
<a class="jxr_linenumber" name="160" href="#160">160</a>         sqlText.append(<span class="jxr_string">"      ON ((sm.sesid = cm.sesid) AND (sm.emplid = cm.emplid))),\n"</span>);
<a class="jxr_linenumber" name="161" href="#161">161</a>         sqlText.append(<span class="jxr_string">"      LD_BCN_BUILD_SALSUMM01_MT sd \n"</span>);
<a class="jxr_linenumber" name="162" href="#162">162</a>         sqlText.append(<span class="jxr_string">"WHERE sm.sesid = ? \n"</span>);
<a class="jxr_linenumber" name="163" href="#163">163</a>         sqlText.append(<span class="jxr_string">" AND sd.sesid = sm.sesid \n"</span>);
<a class="jxr_linenumber" name="164" href="#164">164</a>         sqlText.append(<span class="jxr_string">" AND sd.emplid = sm.emplid \n"</span>);
<a class="jxr_linenumber" name="165" href="#165">165</a>         sqlText.append(<span class="jxr_string">"GROUP BY sm.emplid, sm.sal_mths, sm.sal_pmths, cm.csf_mths, cm.csf_pmths \n"</span>);
<a class="jxr_linenumber" name="166" href="#166">166</a> 
<a class="jxr_linenumber" name="167" href="#167">167</a>         updateReportsSalarySummaryThreshold.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText));
<a class="jxr_linenumber" name="168" href="#168">168</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="169" href="#169">169</a> 
<a class="jxr_linenumber" name="170" href="#170">170</a>         <em class="jxr_comment">/*<em class="jxr_comment"> restate the csf for all records, adjusting it so that it reflects changes in months appointment and percent time. */</em></em>
<a class="jxr_linenumber" name="171" href="#171">171</a>         <em class="jxr_comment">/*<em class="jxr_comment"> the adjustment factor is (req pct time/base pct time)(req mnths appt/req position mnths appt)/(base mnths appt)/(base position mnths appt)*/</em></em>
<a class="jxr_linenumber" name="172" href="#172">172</a>         sqlText.append(<span class="jxr_string">"UPDATE LD_BCN_BUILD_SALSUMM04_MT \n"</span>);
<a class="jxr_linenumber" name="173" href="#173">173</a>         sqlText.append(<span class="jxr_string">"SET res_csf_amt = ROUND(COALESCE(((pos_csf_amt * sal_pct * sal_mths * csf_pmths) \n"</span>);
<a class="jxr_linenumber" name="174" href="#174">174</a>         sqlText.append(<span class="jxr_string">" / (pos_csf_tm_pct * csf_mths * sal_pmths)), 0.00),0) \n"</span>);
<a class="jxr_linenumber" name="175" href="#175">175</a>         sqlText.append(<span class="jxr_string">"WHERE sesid = ? AND pos_csf_tm_pct &lt;&gt; 0 AND csf_mths &lt;&gt; 0 AND sal_pmths &lt;&gt; 0 \n"</span>);
<a class="jxr_linenumber" name="176" href="#176">176</a> 
<a class="jxr_linenumber" name="177" href="#177">177</a>         updateReportsSalarySummaryThreshold.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText));
<a class="jxr_linenumber" name="178" href="#178">178</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="179" href="#179">179</a> 
<a class="jxr_linenumber" name="180" href="#180">180</a>         <em class="jxr_comment">/*<em class="jxr_comment"> restate the csf amt for change in fte scale */</em></em>
<a class="jxr_linenumber" name="181" href="#181">181</a>         sqlText.append(<span class="jxr_string">"UPDATE LD_BCN_BUILD_SALSUMM04_MT \n"</span>);
<a class="jxr_linenumber" name="182" href="#182">182</a>         sqlText.append(<span class="jxr_string">"SET res_csf_amt = ROUND(COALESCE(((res_csf_amt * sal_pmths) / csf_pmths), 0.00),0) \n"</span>);
<a class="jxr_linenumber" name="183" href="#183">183</a>         sqlText.append(<span class="jxr_string">"WHERE sesid = ? AND sal_pmths &lt;&gt; csf_pmths AND csf_pmths &lt;&gt; 0 \n"</span>);
<a class="jxr_linenumber" name="184" href="#184">184</a> 
<a class="jxr_linenumber" name="185" href="#185">185</a>         updateReportsSalarySummaryThreshold.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText));
<a class="jxr_linenumber" name="186" href="#186">186</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="187" href="#187">187</a> 
<a class="jxr_linenumber" name="188" href="#188">188</a>         <em class="jxr_comment">/*<em class="jxr_comment"> produce emplid set for recs &gt;= threshold */</em></em>
<a class="jxr_linenumber" name="189" href="#189">189</a>         sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_BUILD_SALSUMM05_MT \n"</span>);
<a class="jxr_linenumber" name="190" href="#190">190</a>         sqlText.append(<span class="jxr_string">"(SESID, EMPLID) \n"</span>);
<a class="jxr_linenumber" name="191" href="#191">191</a>         sqlText.append(<span class="jxr_string">"SELECT ?, emplid \n"</span>);
<a class="jxr_linenumber" name="192" href="#192">192</a>         sqlText.append(<span class="jxr_string">"FROM LD_BCN_BUILD_SALSUMM04_MT \n"</span>);
<a class="jxr_linenumber" name="193" href="#193">193</a>         sqlText.append(<span class="jxr_string">"WHERE sesid = ? \n"</span>);
<a class="jxr_linenumber" name="194" href="#194">194</a>         sqlText.append(<span class="jxr_string">" AND ROUND((((sal_amt - res_csf_amt) / res_csf_amt) * 100),1) &gt;= ? \n"</span>);
<a class="jxr_linenumber" name="195" href="#195">195</a>         sqlText.append(<span class="jxr_string">" AND res_csf_amt &lt;&gt; 0 \n"</span>);
<a class="jxr_linenumber" name="196" href="#196">196</a>         sqlText.append(<span class="jxr_string">" AND sal_amt &lt;&gt; 0 \n"</span>);
<a class="jxr_linenumber" name="197" href="#197">197</a> 
<a class="jxr_linenumber" name="198" href="#198">198</a>         salarySummaryAboveThreshold.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText));
<a class="jxr_linenumber" name="199" href="#199">199</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="200" href="#200">200</a> 
<a class="jxr_linenumber" name="201" href="#201">201</a>         <em class="jxr_comment">/*<em class="jxr_comment"> produce emplid set for recs &lt;= threshold */</em></em>
<a class="jxr_linenumber" name="202" href="#202">202</a>         sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_BUILD_SALSUMM05_MT \n"</span>);
<a class="jxr_linenumber" name="203" href="#203">203</a>         sqlText.append(<span class="jxr_string">"(SESID, EMPLID) \n"</span>);
<a class="jxr_linenumber" name="204" href="#204">204</a>         sqlText.append(<span class="jxr_string">"SELECT ?, emplid \n"</span>);
<a class="jxr_linenumber" name="205" href="#205">205</a>         sqlText.append(<span class="jxr_string">"FROM LD_BCN_BUILD_SALSUMM04_MT \n"</span>);
<a class="jxr_linenumber" name="206" href="#206">206</a>         sqlText.append(<span class="jxr_string">"WHERE sesid = ? \n"</span>);
<a class="jxr_linenumber" name="207" href="#207">207</a>         sqlText.append(<span class="jxr_string">" AND ROUND((((sal_amt - res_csf_amt) / res_csf_amt) * 100),1) &lt;= ? \n"</span>);
<a class="jxr_linenumber" name="208" href="#208">208</a>         sqlText.append(<span class="jxr_string">" AND res_csf_amt &lt;&gt; 0 \n"</span>);
<a class="jxr_linenumber" name="209" href="#209">209</a>         sqlText.append(<span class="jxr_string">" AND sal_amt &lt;&gt; 0 \n"</span>);
<a class="jxr_linenumber" name="210" href="#210">210</a> 
<a class="jxr_linenumber" name="211" href="#211">211</a>         salarySummaryBelowThreshold.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText));
<a class="jxr_linenumber" name="212" href="#212">212</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="213" href="#213">213</a> 
<a class="jxr_linenumber" name="214" href="#214">214</a> 
<a class="jxr_linenumber" name="215" href="#215">215</a>         <em class="jxr_comment">/*<em class="jxr_comment"> get EMPLIDs with at least one reason rec from the list of select reasons */</em></em>
<a class="jxr_linenumber" name="216" href="#216">216</a>         sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_BUILD_SALSUMM05_MT\n"</span>);
<a class="jxr_linenumber" name="217" href="#217">217</a>         sqlText.append(<span class="jxr_string">"(SESID, EMPLID) \n"</span>);
<a class="jxr_linenumber" name="218" href="#218">218</a>         sqlText.append(<span class="jxr_string">"SELECT DISTINCT ?, bcaf.emplid  \n"</span>);
<a class="jxr_linenumber" name="219" href="#219">219</a>         sqlText.append(<span class="jxr_string">"FROM LD_BCN_CTRL_LIST_T ctrl, LD_PNDBC_APPTFND_T bcaf, LD_BCN_OBJ_PICK_T pick, LD_BCN_AF_REASON_T reas, LD_BCN_RSN_CD_PK_T rpk \n"</span>);
<a class="jxr_linenumber" name="220" href="#220">220</a>         sqlText.append(<span class="jxr_string">"WHERE ctrl.person_unvl_id = ? \n"</span>);
<a class="jxr_linenumber" name="221" href="#221">221</a>         sqlText.append(<span class="jxr_string">" AND bcaf.univ_fiscal_yr = ctrl.univ_fiscal_yr \n"</span>);
<a class="jxr_linenumber" name="222" href="#222">222</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_coa_cd = ctrl.fin_coa_cd \n"</span>);
<a class="jxr_linenumber" name="223" href="#223">223</a>         sqlText.append(<span class="jxr_string">" AND bcaf.account_nbr = ctrl.account_nbr \n"</span>);
<a class="jxr_linenumber" name="224" href="#224">224</a>         sqlText.append(<span class="jxr_string">" AND bcaf.sub_acct_nbr = ctrl.sub_acct_nbr \n"</span>);
<a class="jxr_linenumber" name="225" href="#225">225</a>         sqlText.append(<span class="jxr_string">" AND bcaf.emplid &lt;&gt; '"</span>);
<a class="jxr_linenumber" name="226" href="#226">226</a>         <em class="jxr_comment">//  empolyee ID for a vacant line in budget construction CSF and appointment funding</em>
<a class="jxr_linenumber" name="227" href="#227">227</a>         insertionPoints.add(sqlText.length());
<a class="jxr_linenumber" name="228" href="#228">228</a>         sqlText.append(<span class="jxr_string">"' \n"</span>);
<a class="jxr_linenumber" name="229" href="#229">229</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_object_cd = pick.fin_object_cd \n"</span>);
<a class="jxr_linenumber" name="230" href="#230">230</a>         sqlText.append(<span class="jxr_string">" AND pick.person_unvl_id = ctrl.person_unvl_id \n"</span>);
<a class="jxr_linenumber" name="231" href="#231">231</a>         sqlText.append(<span class="jxr_string">" AND pick.select_flag &gt; 0 \n"</span>);
<a class="jxr_linenumber" name="232" href="#232">232</a>         sqlText.append(<span class="jxr_string">" AND bcaf.univ_fiscal_yr = reas.univ_fiscal_yr \n"</span>);
<a class="jxr_linenumber" name="233" href="#233">233</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_coa_cd = reas.fin_coa_cd \n"</span>);
<a class="jxr_linenumber" name="234" href="#234">234</a>         sqlText.append(<span class="jxr_string">" AND bcaf.account_nbr = reas.account_nbr \n"</span>);
<a class="jxr_linenumber" name="235" href="#235">235</a>         sqlText.append(<span class="jxr_string">" AND bcaf.sub_acct_nbr = reas.sub_acct_nbr \n"</span>);
<a class="jxr_linenumber" name="236" href="#236">236</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_object_cd = reas.fin_object_cd \n"</span>);
<a class="jxr_linenumber" name="237" href="#237">237</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_sub_obj_cd = reas.fin_sub_obj_cd \n"</span>);
<a class="jxr_linenumber" name="238" href="#238">238</a>         sqlText.append(<span class="jxr_string">" AND bcaf.position_nbr = reas.position_nbr \n"</span>);
<a class="jxr_linenumber" name="239" href="#239">239</a>         sqlText.append(<span class="jxr_string">" AND bcaf.emplid = reas.emplid \n"</span>);
<a class="jxr_linenumber" name="240" href="#240">240</a>         sqlText.append(<span class="jxr_string">" AND reas.appt_fnd_reason_cd = rpk.appt_fnd_reason_cd \n"</span>);
<a class="jxr_linenumber" name="241" href="#241">241</a>         sqlText.append(<span class="jxr_string">" AND rpk.person_unvl_id = ctrl.person_unvl_id \n"</span>);
<a class="jxr_linenumber" name="242" href="#242">242</a>         sqlText.append(<span class="jxr_string">" AND rpk.select_flag &lt;&gt; 0 \n"</span>);
<a class="jxr_linenumber" name="243" href="#243">243</a> 
<a class="jxr_linenumber" name="244" href="#244">244</a>         updateReportsSalarySummaryNoThresholdReason.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText,insertionPoints));
<a class="jxr_linenumber" name="245" href="#245">245</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="246" href="#246">246</a>         insertionPoints.clear();
<a class="jxr_linenumber" name="247" href="#247">247</a> 
<a class="jxr_linenumber" name="248" href="#248">248</a>         <em class="jxr_comment">/*<em class="jxr_comment"> get all EMPLIDs for the selection */</em></em>
<a class="jxr_linenumber" name="249" href="#249">249</a>         sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_BUILD_SALSUMM05_MT \n"</span>);
<a class="jxr_linenumber" name="250" href="#250">250</a>         sqlText.append(<span class="jxr_string">"(SESID, EMPLID) \n"</span>);
<a class="jxr_linenumber" name="251" href="#251">251</a>         sqlText.append(<span class="jxr_string">"SELECT DISTINCT ?, bcaf.emplid \n"</span>);
<a class="jxr_linenumber" name="252" href="#252">252</a>         sqlText.append(<span class="jxr_string">"FROM LD_BCN_CTRL_LIST_T ctrl, LD_PNDBC_APPTFND_T bcaf, LD_BCN_OBJ_PICK_T pick \n"</span>);
<a class="jxr_linenumber" name="253" href="#253">253</a>         sqlText.append(<span class="jxr_string">"WHERE ctrl.person_unvl_id = ? \n"</span>);
<a class="jxr_linenumber" name="254" href="#254">254</a>         sqlText.append(<span class="jxr_string">" AND bcaf.univ_fiscal_yr = ctrl.univ_fiscal_yr \n"</span>);
<a class="jxr_linenumber" name="255" href="#255">255</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_coa_cd = ctrl.fin_coa_cd \n"</span>);
<a class="jxr_linenumber" name="256" href="#256">256</a>         sqlText.append(<span class="jxr_string">" AND bcaf.account_nbr = ctrl.account_nbr \n"</span>);
<a class="jxr_linenumber" name="257" href="#257">257</a>         sqlText.append(<span class="jxr_string">" AND bcaf.sub_acct_nbr = ctrl.sub_acct_nbr \n"</span>);
<a class="jxr_linenumber" name="258" href="#258">258</a>         sqlText.append(<span class="jxr_string">" AND bcaf.emplid &lt;&gt; '"</span>);
<a class="jxr_linenumber" name="259" href="#259">259</a>         <em class="jxr_comment">//  empolyee ID for a vacant line in budget construction CSF and appointment funding</em>
<a class="jxr_linenumber" name="260" href="#260">260</a>         insertionPoints.add(sqlText.length());
<a class="jxr_linenumber" name="261" href="#261">261</a>         sqlText.append(<span class="jxr_string">"' \n"</span>);
<a class="jxr_linenumber" name="262" href="#262">262</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_object_cd = pick.fin_object_cd \n"</span>);
<a class="jxr_linenumber" name="263" href="#263">263</a>         sqlText.append(<span class="jxr_string">" AND pick.person_unvl_id = ctrl.person_unvl_id \n"</span>);
<a class="jxr_linenumber" name="264" href="#264">264</a>         sqlText.append(<span class="jxr_string">" AND pick.select_flag &gt; 0 \n"</span>);
<a class="jxr_linenumber" name="265" href="#265">265</a>         
<a class="jxr_linenumber" name="266" href="#266">266</a>         updateReportsSalarySummaryNoThresholdNoReason.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText,insertionPoints));
<a class="jxr_linenumber" name="267" href="#267">267</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="268" href="#268">268</a>         insertionPoints.clear();
<a class="jxr_linenumber" name="269" href="#269">269</a>         
<a class="jxr_linenumber" name="270" href="#270">270</a>         <em class="jxr_comment">/*<em class="jxr_comment">  these are the two common driving SQL statements for all the reports  */</em></em>
<a class="jxr_linenumber" name="271" href="#271">271</a> 
<a class="jxr_linenumber" name="272" href="#272">272</a>         <em class="jxr_comment">/*<em class="jxr_comment"> get the name recs for the set of EMPLIDs */</em></em>
<a class="jxr_linenumber" name="273" href="#273">273</a>         sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_SAL_SSN_T \n"</span>);
<a class="jxr_linenumber" name="274" href="#274">274</a>         sqlText.append(<span class="jxr_string">"(PERSON_UNVL_ID, ORG_FIN_COA_CD, ORG_CD, PERSON_NM, EMPLID)"</span>);
<a class="jxr_linenumber" name="275" href="#275">275</a>         sqlText.append(<span class="jxr_string">"SELECT DISTINCT ?, ctrl.sel_org_fin_coa, ctrl.sel_org_cd, iinc.person_nm, bcaf.emplid \n"</span>);
<a class="jxr_linenumber" name="276" href="#276">276</a>         sqlText.append(<span class="jxr_string">"FROM LD_BCN_CTRL_LIST_T ctrl, LD_PNDBC_APPTFND_T bcaf, LD_BCN_BUILD_SALSUMM05_MT tssn, LD_BCN_OBJ_PICK_T pick, LD_BCN_INTINCBNT_T iinc \n"</span>);
<a class="jxr_linenumber" name="277" href="#277">277</a>         sqlText.append(<span class="jxr_string">"WHERE  ctrl.person_unvl_id = ? \n"</span>);
<a class="jxr_linenumber" name="278" href="#278">278</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_coa_cd = ctrl.fin_coa_cd \n"</span>);
<a class="jxr_linenumber" name="279" href="#279">279</a>         sqlText.append(<span class="jxr_string">" AND bcaf.account_nbr = ctrl.account_nbr \n"</span>);
<a class="jxr_linenumber" name="280" href="#280">280</a>         sqlText.append(<span class="jxr_string">" AND bcaf.sub_acct_nbr = ctrl.sub_acct_nbr \n"</span>);
<a class="jxr_linenumber" name="281" href="#281">281</a>         sqlText.append(<span class="jxr_string">" AND bcaf.emplid = iinc.emplid \n"</span>);
<a class="jxr_linenumber" name="282" href="#282">282</a>         sqlText.append(<span class="jxr_string">" AND bcaf.emplid = tssn.emplid \n"</span>);
<a class="jxr_linenumber" name="283" href="#283">283</a>         sqlText.append(<span class="jxr_string">" AND tssn.sesid = ? \n"</span>);
<a class="jxr_linenumber" name="284" href="#284">284</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_object_cd = pick.fin_object_cd \n"</span>);
<a class="jxr_linenumber" name="285" href="#285">285</a>         sqlText.append(<span class="jxr_string">" AND pick.person_unvl_id = ctrl.person_unvl_id \n"</span>);
<a class="jxr_linenumber" name="286" href="#286">286</a>         sqlText.append(<span class="jxr_string">" AND pick.select_flag &gt; 0 \n"</span>);
<a class="jxr_linenumber" name="287" href="#287">287</a> 
<a class="jxr_linenumber" name="288" href="#288">288</a>         updateReportsSalarySummaryCommon.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText));
<a class="jxr_linenumber" name="289" href="#289">289</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="290" href="#290">290</a> 
<a class="jxr_linenumber" name="291" href="#291">291</a>         <em class="jxr_comment">/*<em class="jxr_comment"> get the detail recs for the set of EMPLIDs */</em></em>
<a class="jxr_linenumber" name="292" href="#292">292</a>         sqlText.append(<span class="jxr_string">"INSERT INTO LD_BCN_SAL_FND_T \n"</span>);
<a class="jxr_linenumber" name="293" href="#293">293</a>         sqlText.append(<span class="jxr_string">"(PERSON_UNVL_ID, EMPLID, POSITION_NBR, UNIV_FISCAL_YR, FIN_COA_CD,  \n"</span>);
<a class="jxr_linenumber" name="294" href="#294">294</a>         sqlText.append(<span class="jxr_string">" ACCOUNT_NBR, SUB_ACCT_NBR, FIN_OBJECT_CD, FIN_SUB_OBJ_CD) \n"</span>);
<a class="jxr_linenumber" name="295" href="#295">295</a>         sqlText.append(<span class="jxr_string">"SELECT DISTINCT ?, bcaf.emplid, bcaf.position_nbr, bcaf.univ_fiscal_yr, bcaf.fin_coa_cd, \n"</span>);
<a class="jxr_linenumber" name="296" href="#296">296</a>         sqlText.append(<span class="jxr_string">" bcaf.account_nbr, bcaf.sub_acct_nbr, bcaf.fin_object_cd, bcaf.fin_sub_obj_cd \n"</span>);
<a class="jxr_linenumber" name="297" href="#297">297</a>         sqlText.append(<span class="jxr_string">"FROM LD_BCN_CTRL_LIST_T ctrl, LD_PNDBC_APPTFND_T bcaf, LD_BCN_BUILD_SALSUMM05_MT tssn, LD_BCN_OBJ_PICK_T pick \n"</span>);
<a class="jxr_linenumber" name="298" href="#298">298</a>         sqlText.append(<span class="jxr_string">"WHERE ctrl.person_unvl_id = ? \n"</span>);
<a class="jxr_linenumber" name="299" href="#299">299</a>         sqlText.append(<span class="jxr_string">" AND bcaf.univ_fiscal_yr = ctrl.univ_fiscal_yr \n"</span>);
<a class="jxr_linenumber" name="300" href="#300">300</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_coa_cd = ctrl.fin_coa_cd \n"</span>);
<a class="jxr_linenumber" name="301" href="#301">301</a>         sqlText.append(<span class="jxr_string">" AND bcaf.account_nbr = ctrl.account_nbr \n"</span>);
<a class="jxr_linenumber" name="302" href="#302">302</a>         sqlText.append(<span class="jxr_string">" AND bcaf.sub_acct_nbr = ctrl.sub_acct_nbr \n"</span>);
<a class="jxr_linenumber" name="303" href="#303">303</a>         sqlText.append(<span class="jxr_string">" AND bcaf.emplid = tssn.emplid \n"</span>);
<a class="jxr_linenumber" name="304" href="#304">304</a>         sqlText.append(<span class="jxr_string">" AND tssn.sesid = ? \n"</span>);
<a class="jxr_linenumber" name="305" href="#305">305</a>         sqlText.append(<span class="jxr_string">" AND bcaf.fin_object_cd = pick.fin_object_cd \n"</span>);
<a class="jxr_linenumber" name="306" href="#306">306</a>         sqlText.append(<span class="jxr_string">" AND pick.person_unvl_id = ctrl.person_unvl_id \n"</span>);
<a class="jxr_linenumber" name="307" href="#307">307</a>         sqlText.append(<span class="jxr_string">" AND pick.select_flag &gt; 0 \n"</span>);
<a class="jxr_linenumber" name="308" href="#308">308</a>           
<a class="jxr_linenumber" name="309" href="#309">309</a>         updateReportsSalarySummaryCommon.add(<strong class="jxr_keyword">new</strong> <a href="../../../../../../../../org/kuali/kfs/module/bc/batch/dataaccess/impl/SQLForStep.html">SQLForStep</a>(sqlText));
<a class="jxr_linenumber" name="310" href="#310">310</a>         sqlText.delete(0, sqlText.length());
<a class="jxr_linenumber" name="311" href="#311">311</a> 
<a class="jxr_linenumber" name="312" href="#312">312</a>     }
<a class="jxr_linenumber" name="313" href="#313">313</a> 
<a class="jxr_linenumber" name="314" href="#314">314</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="315" href="#315">315</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="316" href="#316">316</a> <em class="jxr_javadoccomment">     * clean out all rows in the report tables associated with this user</em>
<a class="jxr_linenumber" name="317" href="#317">317</a> <em class="jxr_javadoccomment">     * @param principalName--the user requesting the report</em>
<a class="jxr_linenumber" name="318" href="#318">318</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="319" href="#319">319</a>     <strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> clearUserPreviouSalarySummaryReports(String principalName) {
<a class="jxr_linenumber" name="320" href="#320">320</a>         <strong class="jxr_keyword">this</strong>.clearTempTableByUnvlId(<span class="jxr_string">"LD_BCN_SAL_SSN_T"</span>, <span class="jxr_string">"PERSON_UNVL_ID"</span>, principalName);
<a class="jxr_linenumber" name="321" href="#321">321</a>         <strong class="jxr_keyword">this</strong>.clearTempTableByUnvlId(<span class="jxr_string">"LD_BCN_SAL_FND_T"</span>, <span class="jxr_string">"PERSON_UNVL_ID"</span>, principalName);
<a class="jxr_linenumber" name="322" href="#322">322</a>     }
<a class="jxr_linenumber" name="323" href="#323">323</a>     
<a class="jxr_linenumber" name="324" href="#324">324</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="325" href="#325">325</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="326" href="#326">326</a> <em class="jxr_javadoccomment">     * clean out the work table used by all reports</em>
<a class="jxr_linenumber" name="327" href="#327">327</a> <em class="jxr_javadoccomment">     * @param idForSession--the session which requested the report</em>
<a class="jxr_linenumber" name="328" href="#328">328</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="329" href="#329">329</a>     <strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> clearCommonWorkTable(String idForSession) {
<a class="jxr_linenumber" name="330" href="#330">330</a>         <strong class="jxr_keyword">this</strong>.clearTempTableBySesId(<span class="jxr_string">"LD_BCN_BUILD_SALSUMM05_MT"</span>, <span class="jxr_string">"SESID"</span>, idForSession);
<a class="jxr_linenumber" name="331" href="#331">331</a>     }
<a class="jxr_linenumber" name="332" href="#332">332</a>     
<a class="jxr_linenumber" name="333" href="#333">333</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="334" href="#334">334</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="335" href="#335">335</a> <em class="jxr_javadoccomment">     * clean out the work tables for reporting by threshold</em>
<a class="jxr_linenumber" name="336" href="#336">336</a> <em class="jxr_javadoccomment">     * @param idForSession--the session which requested the report</em>
<a class="jxr_linenumber" name="337" href="#337">337</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="338" href="#338">338</a>     <strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> clearThresholdWorkTables(String idForSession) {
<a class="jxr_linenumber" name="339" href="#339">339</a>         <strong class="jxr_keyword">this</strong>.clearTempTableBySesId(<span class="jxr_string">"LD_BCN_BUILD_SALSUMM01_MT"</span>, <span class="jxr_string">"SESID"</span>, idForSession);
<a class="jxr_linenumber" name="340" href="#340">340</a>         <strong class="jxr_keyword">this</strong>.clearTempTableBySesId(<span class="jxr_string">"LD_BCN_BUILD_SALSUMM02_MT"</span>, <span class="jxr_string">"SESID"</span>, idForSession);
<a class="jxr_linenumber" name="341" href="#341">341</a>         <strong class="jxr_keyword">this</strong>.clearTempTableBySesId(<span class="jxr_string">"LD_BCN_BUILD_SALSUMM03_MT"</span>, <span class="jxr_string">"SESID"</span>, idForSession);
<a class="jxr_linenumber" name="342" href="#342">342</a>         <strong class="jxr_keyword">this</strong>.clearTempTableBySesId(<span class="jxr_string">"LD_BCN_BUILD_SALSUMM04_MT"</span>, <span class="jxr_string">"SESID"</span>, idForSession);
<a class="jxr_linenumber" name="343" href="#343">343</a>     }
<a class="jxr_linenumber" name="344" href="#344">344</a>     
<a class="jxr_linenumber" name="345" href="#345">345</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="346" href="#346">346</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="347" href="#347">347</a> <em class="jxr_javadoccomment">     * runs SQL used by every report</em>
<a class="jxr_linenumber" name="348" href="#348">348</a> <em class="jxr_javadoccomment">     * @param principalName--the user requesting the report</em>
<a class="jxr_linenumber" name="349" href="#349">349</a> <em class="jxr_javadoccomment">     * @param idForSession--the session of the user</em>
<a class="jxr_linenumber" name="350" href="#350">350</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="351" href="#351">351</a>     <strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> runCommonSQLForSalaryReports(String principalName, String idForSession) {
<a class="jxr_linenumber" name="352" href="#352">352</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryCommon.get(0).getSQL(), principalName, principalName, idForSession);
<a class="jxr_linenumber" name="353" href="#353">353</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryCommon.get(1).getSQL(), principalName, principalName, idForSession);
<a class="jxr_linenumber" name="354" href="#354">354</a>         clearCommonWorkTable(idForSession);
<a class="jxr_linenumber" name="355" href="#355">355</a>     }
<a class="jxr_linenumber" name="356" href="#356">356</a>     
<a class="jxr_linenumber" name="357" href="#357">357</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="358" href="#358">358</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="359" href="#359">359</a> <em class="jxr_javadoccomment">     * @see org.kuali.kfs.module.bc.document.dataaccess.BudgetConstructionSalarySummaryReportDao#salarySummaryReports(java.lang.String, java.lang.Integer, boolean, org.kuali.rice.kns.util.KualiDecimal)</em>
<a class="jxr_linenumber" name="360" href="#360">360</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="361" href="#361">361</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> updateSalaryAndReasonSummaryReportsWithThreshold(String principalName, Integer previousFiscalYear, <strong class="jxr_keyword">boolean</strong> reportGreaterThanOrEqualToThreshold, KualiDecimal threshold) {
<a class="jxr_linenumber" name="362" href="#362">362</a>         <em class="jxr_comment">// get the session ID</em>
<a class="jxr_linenumber" name="363" href="#363">363</a>         Guid guid = <strong class="jxr_keyword">new</strong> Guid();
<a class="jxr_linenumber" name="364" href="#364">364</a>         String idForSession = guid.toString();
<a class="jxr_linenumber" name="365" href="#365">365</a>         
<a class="jxr_linenumber" name="366" href="#366">366</a>         <em class="jxr_comment">// clean out anything left from a previous report requested by this user</em>
<a class="jxr_linenumber" name="367" href="#367">367</a>         clearUserPreviouSalarySummaryReports(principalName);
<a class="jxr_linenumber" name="368" href="#368">368</a>         
<a class="jxr_linenumber" name="369" href="#369">369</a>         <em class="jxr_comment">// default duration code is inserted into a couple of the SQL queries--get it now</em>
<a class="jxr_linenumber" name="370" href="#370">370</a>         ArrayList&lt;String&gt; durationCodeDefault = <strong class="jxr_keyword">new</strong> ArrayList&lt;String&gt;(2);
<a class="jxr_linenumber" name="371" href="#371">371</a>         durationCodeDefault.add(BCConstants.VACANT_EMPLID);
<a class="jxr_linenumber" name="372" href="#372">372</a>         durationCodeDefault.add(BCConstants.AppointmentFundingDurationCodes.NONE.durationCode);
<a class="jxr_linenumber" name="373" href="#373">373</a>         
<a class="jxr_linenumber" name="374" href="#374">374</a>         <em class="jxr_comment">// fetch the base and request salary parameters for people who are marked as not going on leave</em>
<a class="jxr_linenumber" name="375" href="#375">375</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryThreshold.get(0).getSQL(durationCodeDefault), idForSession, principalName);
<a class="jxr_linenumber" name="376" href="#376">376</a>         <em class="jxr_comment">// fetch the base and request salary parameters for people who are marked as going on leave</em>
<a class="jxr_linenumber" name="377" href="#377">377</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryThreshold.get(1).getSQL(durationCodeDefault), idForSession, principalName);
<a class="jxr_linenumber" name="378" href="#378">378</a>         <em class="jxr_comment">// take request percent time, months appointment, and position months from the row with the largest request salary</em>
<a class="jxr_linenumber" name="379" href="#379">379</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryThreshold.get(2).getSQL(), idForSession, idForSession);
<a class="jxr_linenumber" name="380" href="#380">380</a>         <em class="jxr_comment">// take base percent time, months appointment, and position months from the row with the largest base salary</em>
<a class="jxr_linenumber" name="381" href="#381">381</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryThreshold.get(3).getSQL(), idForSession, idForSession, previousFiscalYear);
<a class="jxr_linenumber" name="382" href="#382">382</a>         <em class="jxr_comment">// combine the base and request months/percent time/position months into a single table</em>
<a class="jxr_linenumber" name="383" href="#383">383</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryThreshold.get(4).getSQL(), idForSession, idForSession);
<a class="jxr_linenumber" name="384" href="#384">384</a>         <em class="jxr_comment">// adjust the base salary so that it reflects the same appointment parameters as the request salary (increase it if the person will work 12 months this year, but worked only 10 last year, for example)</em>
<a class="jxr_linenumber" name="385" href="#385">385</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryThreshold.get(5).getSQL(), idForSession);
<a class="jxr_linenumber" name="386" href="#386">386</a>         <em class="jxr_comment">// adjust the base salary for changes in the position months versus last year</em>
<a class="jxr_linenumber" name="387" href="#387">387</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryThreshold.get(6).getSQL(), idForSession);
<a class="jxr_linenumber" name="388" href="#388">388</a>         <em class="jxr_comment">// the salaries taken will either be above or below the threshold</em>
<a class="jxr_linenumber" name="389" href="#389">389</a>         <em class="jxr_comment">// April 09, 2008: Jdbc (at least Oracle's implementation) chokes on a KualiDecimal, with a message that says "illegal column type"</em>
<a class="jxr_linenumber" name="390" href="#390">390</a>         <em class="jxr_comment">// a simple cast to Number has the same result</em>
<a class="jxr_linenumber" name="391" href="#391">391</a>         <em class="jxr_comment">// using the code below works</em>
<a class="jxr_linenumber" name="392" href="#392">392</a>         BigDecimal thresholdValue = threshold.bigDecimalValue();
<a class="jxr_linenumber" name="393" href="#393">393</a>         <strong class="jxr_keyword">if</strong> (reportGreaterThanOrEqualToThreshold)
<a class="jxr_linenumber" name="394" href="#394">394</a>         {
<a class="jxr_linenumber" name="395" href="#395">395</a>             getSimpleJdbcTemplate().update(salarySummaryAboveThreshold.get(0).getSQL(), idForSession, idForSession, thresholdValue);
<a class="jxr_linenumber" name="396" href="#396">396</a>         }
<a class="jxr_linenumber" name="397" href="#397">397</a>         <strong class="jxr_keyword">else</strong>
<a class="jxr_linenumber" name="398" href="#398">398</a>         {
<a class="jxr_linenumber" name="399" href="#399">399</a>             getSimpleJdbcTemplate().update(salarySummaryBelowThreshold.get(0).getSQL(), idForSession, idForSession, thresholdValue);
<a class="jxr_linenumber" name="400" href="#400">400</a>         }
<a class="jxr_linenumber" name="401" href="#401">401</a>         <em class="jxr_comment">// populate the holding table with the rows to be reported</em>
<a class="jxr_linenumber" name="402" href="#402">402</a>         <em class="jxr_comment">// (only request is reported--the base was manipulated above to identify people above and below the threshold)</em>
<a class="jxr_linenumber" name="403" href="#403">403</a>         <em class="jxr_comment">// name records for the rows to be reported</em>
<a class="jxr_linenumber" name="404" href="#404">404</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryCommon.get(0).getSQL(), principalName, principalName, idForSession);
<a class="jxr_linenumber" name="405" href="#405">405</a>         <em class="jxr_comment">// salary data for the rows to be reported</em>
<a class="jxr_linenumber" name="406" href="#406">406</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryCommon.get(1).getSQL(), principalName, principalName, idForSession);
<a class="jxr_linenumber" name="407" href="#407">407</a>         
<a class="jxr_linenumber" name="408" href="#408">408</a>         <em class="jxr_comment">// clear out the threshold work tables for this session</em>
<a class="jxr_linenumber" name="409" href="#409">409</a>         clearThresholdWorkTables(idForSession);
<a class="jxr_linenumber" name="410" href="#410">410</a>         <em class="jxr_comment">// clear out the common work table for this session</em>
<a class="jxr_linenumber" name="411" href="#411">411</a>         clearCommonWorkTable(idForSession);
<a class="jxr_linenumber" name="412" href="#412">412</a>         <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="413" href="#413">413</a> <em class="jxr_javadoccomment">         * this is necessary to clear any rows for the tables we have just updated from the OJB cache.  otherwise, subsequent calls to OJB will fetch the old, unupdated cached rows.</em>
<a class="jxr_linenumber" name="414" href="#414">414</a> <em class="jxr_javadoccomment">         */</em>
<a class="jxr_linenumber" name="415" href="#415">415</a>         persistenceService.clearCache();
<a class="jxr_linenumber" name="416" href="#416">416</a>     }
<a class="jxr_linenumber" name="417" href="#417">417</a>     
<a class="jxr_linenumber" name="418" href="#418">418</a> 
<a class="jxr_linenumber" name="419" href="#419">419</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="420" href="#420">420</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="421" href="#421">421</a> <em class="jxr_javadoccomment">     * @see org.kuali.kfs.module.bc.document.dataaccess.BudgetConstructionSalarySummaryReportDao#reasonSummaryReports(java.lang.String, boolean)</em>
<a class="jxr_linenumber" name="422" href="#422">422</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="423" href="#423">423</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> updateSalaryAndReasonSummaryReportsWithoutThreshold(String principalName, <strong class="jxr_keyword">boolean</strong> listSalariesWithReasonCodes) {
<a class="jxr_linenumber" name="424" href="#424">424</a>         
<a class="jxr_linenumber" name="425" href="#425">425</a>         <em class="jxr_comment">// get the session ID</em>
<a class="jxr_linenumber" name="426" href="#426">426</a>         Guid guid = <strong class="jxr_keyword">new</strong> Guid();
<a class="jxr_linenumber" name="427" href="#427">427</a>         String idForSession = guid.toString();
<a class="jxr_linenumber" name="428" href="#428">428</a>         
<a class="jxr_linenumber" name="429" href="#429">429</a>         <em class="jxr_comment">// get the insertion String for the vacant EMPLID</em>
<a class="jxr_linenumber" name="430" href="#430">430</a>         ArrayList&lt;String&gt; vacantEmplid = <strong class="jxr_keyword">new</strong> ArrayList&lt;String&gt;(1);
<a class="jxr_linenumber" name="431" href="#431">431</a>         vacantEmplid.add(BCConstants.VACANT_EMPLID);
<a class="jxr_linenumber" name="432" href="#432">432</a>         
<a class="jxr_linenumber" name="433" href="#433">433</a>         <em class="jxr_comment">// clean out anything left from a previous report requested by this user</em>
<a class="jxr_linenumber" name="434" href="#434">434</a>         clearUserPreviouSalarySummaryReports(principalName);
<a class="jxr_linenumber" name="435" href="#435">435</a>         
<a class="jxr_linenumber" name="436" href="#436">436</a>         <em class="jxr_comment">//  the option exists to report only those people with a salary increase reason code, or to report everyone</em>
<a class="jxr_linenumber" name="437" href="#437">437</a>         <strong class="jxr_keyword">if</strong> (listSalariesWithReasonCodes)
<a class="jxr_linenumber" name="438" href="#438">438</a>         {
<a class="jxr_linenumber" name="439" href="#439">439</a>             getSimpleJdbcTemplate().update(updateReportsSalarySummaryNoThresholdReason.get(0).getSQL(vacantEmplid), idForSession, principalName);
<a class="jxr_linenumber" name="440" href="#440">440</a>         }
<a class="jxr_linenumber" name="441" href="#441">441</a>         <strong class="jxr_keyword">else</strong>
<a class="jxr_linenumber" name="442" href="#442">442</a>         {
<a class="jxr_linenumber" name="443" href="#443">443</a>             getSimpleJdbcTemplate().update(updateReportsSalarySummaryNoThresholdNoReason.get(0).getSQL(vacantEmplid), idForSession, principalName);
<a class="jxr_linenumber" name="444" href="#444">444</a>         }
<a class="jxr_linenumber" name="445" href="#445">445</a>         <em class="jxr_comment">// populate the holding table with the rows to be reported</em>
<a class="jxr_linenumber" name="446" href="#446">446</a>         <em class="jxr_comment">// name records for the rows to be reported</em>
<a class="jxr_linenumber" name="447" href="#447">447</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryCommon.get(0).getSQL(), principalName, principalName, idForSession);
<a class="jxr_linenumber" name="448" href="#448">448</a>         <em class="jxr_comment">// salary data for the rows to be reported</em>
<a class="jxr_linenumber" name="449" href="#449">449</a>         getSimpleJdbcTemplate().update(updateReportsSalarySummaryCommon.get(1).getSQL(), principalName, principalName, idForSession);
<a class="jxr_linenumber" name="450" href="#450">450</a>         
<a class="jxr_linenumber" name="451" href="#451">451</a>         <em class="jxr_comment">// clear out the common work table for this session</em>
<a class="jxr_linenumber" name="452" href="#452">452</a>         clearCommonWorkTable(idForSession);
<a class="jxr_linenumber" name="453" href="#453">453</a>         <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="454" href="#454">454</a> <em class="jxr_javadoccomment">         * this is necessary to clear any rows for the tables we have just updated from the OJB cache.  otherwise, subsequent calls to OJB will fetch the old, unupdated cached rows.</em>
<a class="jxr_linenumber" name="455" href="#455">455</a> <em class="jxr_javadoccomment">         */</em>
<a class="jxr_linenumber" name="456" href="#456">456</a>         persistenceService.clearCache();
<a class="jxr_linenumber" name="457" href="#457">457</a>     }
<a class="jxr_linenumber" name="458" href="#458">458</a> 
<a class="jxr_linenumber" name="459" href="#459">459</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setPersistenceService(PersistenceService persistenceService)
<a class="jxr_linenumber" name="460" href="#460">460</a>     {
<a class="jxr_linenumber" name="461" href="#461">461</a>         <strong class="jxr_keyword">this</strong>.persistenceService = persistenceService;
<a class="jxr_linenumber" name="462" href="#462">462</a>     }
<a class="jxr_linenumber" name="463" href="#463">463</a> 
<a class="jxr_linenumber" name="464" href="#464">464</a> }
<a class="jxr_linenumber" name="465" href="#465">465</a> 
<a class="jxr_linenumber" name="466" href="#466">466</a> 
<a class="jxr_linenumber" name="467" href="#467">467</a> 
</pre>
<hr/><div id="footer">This page was automatically generated by <a href="http://maven.apache.org/">Maven</a></div></body>
</html>

