<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>FormatServiceImpl xref</title>
<link type="text/css" rel="stylesheet" href="../../../../../../stylesheet.css" />
</head>
<body>
<div id="overview"><a href="../../../../../../../apidocs/org/kuali/kfs/pdp/service/impl/FormatServiceImpl.html">View Javadoc</a></div><pre>

<a class="jxr_linenumber" name="1" href="#1">1</a>   <em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="2" href="#2">2</a>   <em class="jxr_comment"> * Copyright 2011 The Kuali Foundation.</em>
<a class="jxr_linenumber" name="3" href="#3">3</a>   <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="4" href="#4">4</a>   <em class="jxr_comment"> * Licensed under the Educational Community License, Version 2.0 (the "License");</em>
<a class="jxr_linenumber" name="5" href="#5">5</a>   <em class="jxr_comment"> * you may not use this file except in compliance with the License.</em>
<a class="jxr_linenumber" name="6" href="#6">6</a>   <em class="jxr_comment"> * You may obtain a copy of the License at</em>
<a class="jxr_linenumber" name="7" href="#7">7</a>   <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="8" href="#8">8</a>   <em class="jxr_comment"> * <a href="http://www.opensource.org/licenses/ecl2.php" target="alexandria_uri">http://www.opensource.org/licenses/ecl2.php</a></em>
<a class="jxr_linenumber" name="9" href="#9">9</a>   <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="10" href="#10">10</a>  <em class="jxr_comment"> * Unless required by applicable law or agreed to in writing, software</em>
<a class="jxr_linenumber" name="11" href="#11">11</a>  <em class="jxr_comment"> * distributed under the License is distributed on an "AS IS" BASIS,</em>
<a class="jxr_linenumber" name="12" href="#12">12</a>  <em class="jxr_comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</em>
<a class="jxr_linenumber" name="13" href="#13">13</a>  <em class="jxr_comment"> * See the License for the specific language governing permissions and</em>
<a class="jxr_linenumber" name="14" href="#14">14</a>  <em class="jxr_comment"> * limitations under the License.</em>
<a class="jxr_linenumber" name="15" href="#15">15</a>  <em class="jxr_comment"> */</em>
<a class="jxr_linenumber" name="16" href="#16">16</a>  <strong class="jxr_keyword">package</strong> org.kuali.kfs.pdp.service.impl;
<a class="jxr_linenumber" name="17" href="#17">17</a>  
<a class="jxr_linenumber" name="18" href="#18">18</a>  <strong class="jxr_keyword">import</strong> java.sql.Timestamp;
<a class="jxr_linenumber" name="19" href="#19">19</a>  <strong class="jxr_keyword">import</strong> java.util.ArrayList;
<a class="jxr_linenumber" name="20" href="#20">20</a>  <strong class="jxr_keyword">import</strong> java.util.Date;
<a class="jxr_linenumber" name="21" href="#21">21</a>  <strong class="jxr_keyword">import</strong> java.util.HashMap;
<a class="jxr_linenumber" name="22" href="#22">22</a>  <strong class="jxr_keyword">import</strong> java.util.Iterator;
<a class="jxr_linenumber" name="23" href="#23">23</a>  <strong class="jxr_keyword">import</strong> java.util.List;
<a class="jxr_linenumber" name="24" href="#24">24</a>  <strong class="jxr_keyword">import</strong> java.util.Map;
<a class="jxr_linenumber" name="25" href="#25">25</a>  
<a class="jxr_linenumber" name="26" href="#26">26</a>  <strong class="jxr_keyword">import</strong> org.apache.commons.lang.StringUtils;
<a class="jxr_linenumber" name="27" href="#27">27</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.PdpConstants;
<a class="jxr_linenumber" name="28" href="#28">28</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.PdpKeyConstants;
<a class="jxr_linenumber" name="29" href="#29">29</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.PdpParameterConstants;
<a class="jxr_linenumber" name="30" href="#30">30</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.PdpPropertyConstants;
<a class="jxr_linenumber" name="31" href="#31">31</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.batch.service.ExtractPaymentService;
<a class="jxr_linenumber" name="32" href="#32">32</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.AchAccountNumber;
<a class="jxr_linenumber" name="33" href="#33">33</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.CustomerBank;
<a class="jxr_linenumber" name="34" href="#34">34</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.CustomerProfile;
<a class="jxr_linenumber" name="35" href="#35">35</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.DisbursementNumberRange;
<a class="jxr_linenumber" name="36" href="#36">36</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.DisbursementType;
<a class="jxr_linenumber" name="37" href="#37">37</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.FormatProcess;
<a class="jxr_linenumber" name="38" href="#38">38</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.FormatProcessSummary;
<a class="jxr_linenumber" name="39" href="#39">39</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.FormatSelection;
<a class="jxr_linenumber" name="40" href="#40">40</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.PayeeACHAccount;
<a class="jxr_linenumber" name="41" href="#41">41</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.PaymentChangeCode;
<a class="jxr_linenumber" name="42" href="#42">42</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.PaymentDetail;
<a class="jxr_linenumber" name="43" href="#43">43</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.PaymentGroup;
<a class="jxr_linenumber" name="44" href="#44">44</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.PaymentGroupHistory;
<a class="jxr_linenumber" name="45" href="#45">45</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.PaymentProcess;
<a class="jxr_linenumber" name="46" href="#46">46</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.businessobject.PaymentStatus;
<a class="jxr_linenumber" name="47" href="#47">47</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.dataaccess.FormatPaymentDao;
<a class="jxr_linenumber" name="48" href="#48">48</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.dataaccess.PaymentDetailDao;
<a class="jxr_linenumber" name="49" href="#49">49</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.dataaccess.PaymentGroupDao;
<a class="jxr_linenumber" name="50" href="#50">50</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.dataaccess.ProcessDao;
<a class="jxr_linenumber" name="51" href="#51">51</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.service.AchService;
<a class="jxr_linenumber" name="52" href="#52">52</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.service.FormatService;
<a class="jxr_linenumber" name="53" href="#53">53</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.service.PaymentGroupService;
<a class="jxr_linenumber" name="54" href="#54">54</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.service.PendingTransactionService;
<a class="jxr_linenumber" name="55" href="#55">55</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.pdp.service.impl.exception.FormatException;
<a class="jxr_linenumber" name="56" href="#56">56</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.sys.DynamicCollectionComparator;
<a class="jxr_linenumber" name="57" href="#57">57</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.sys.KFSConstants;
<a class="jxr_linenumber" name="58" href="#58">58</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.sys.KFSPropertyConstants;
<a class="jxr_linenumber" name="59" href="#59">59</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.sys.batch.service.SchedulerService;
<a class="jxr_linenumber" name="60" href="#60">60</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.sys.businessobject.Bank;
<a class="jxr_linenumber" name="61" href="#61">61</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.sys.context.SpringContext;
<a class="jxr_linenumber" name="62" href="#62">62</a>  <strong class="jxr_keyword">import</strong> org.kuali.kfs.sys.service.impl.KfsParameterConstants;
<a class="jxr_linenumber" name="63" href="#63">63</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kim.bo.Person;
<a class="jxr_linenumber" name="64" href="#64">64</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kim.service.PersonService;
<a class="jxr_linenumber" name="65" href="#65">65</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kns.service.BusinessObjectService;
<a class="jxr_linenumber" name="66" href="#66">66</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kns.service.DateTimeService;
<a class="jxr_linenumber" name="67" href="#67">67</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kns.service.ParameterService;
<a class="jxr_linenumber" name="68" href="#68">68</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kns.util.GlobalVariables;
<a class="jxr_linenumber" name="69" href="#69">69</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kns.util.KualiInteger;
<a class="jxr_linenumber" name="70" href="#70">70</a>  <strong class="jxr_keyword">import</strong> org.kuali.rice.kns.util.ObjectUtils;
<a class="jxr_linenumber" name="71" href="#71">71</a>  <strong class="jxr_keyword">import</strong> org.springframework.transaction.annotation.Transactional;
<a class="jxr_linenumber" name="72" href="#72">72</a>  
<a class="jxr_linenumber" name="73" href="#73">73</a>  @Transactional
<a class="jxr_linenumber" name="74" href="#74">74</a>  <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">class</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/impl/FormatServiceImpl.html">FormatServiceImpl</a> <strong class="jxr_keyword">implements</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/FormatService.html">FormatService</a> {
<a class="jxr_linenumber" name="75" href="#75">75</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(FormatServiceImpl.<strong class="jxr_keyword">class</strong>);
<a class="jxr_linenumber" name="76" href="#76">76</a>  
<a class="jxr_linenumber" name="77" href="#77">77</a>      <strong class="jxr_keyword">private</strong> <a href="../../../../../../org/kuali/kfs/pdp/dataaccess/PaymentDetailDao.html">PaymentDetailDao</a> paymentDetailDao;
<a class="jxr_linenumber" name="78" href="#78">78</a>      <strong class="jxr_keyword">private</strong> <a href="../../../../../../org/kuali/kfs/pdp/dataaccess/PaymentGroupDao.html">PaymentGroupDao</a> paymentGroupDao;
<a class="jxr_linenumber" name="79" href="#79">79</a>      <strong class="jxr_keyword">private</strong> <a href="../../../../../../org/kuali/kfs/pdp/dataaccess/ProcessDao.html">ProcessDao</a> processDao;
<a class="jxr_linenumber" name="80" href="#80">80</a>      <strong class="jxr_keyword">private</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/AchService.html">AchService</a> achService;
<a class="jxr_linenumber" name="81" href="#81">81</a>      <strong class="jxr_keyword">private</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/PendingTransactionService.html">PendingTransactionService</a> glPendingTransactionService;
<a class="jxr_linenumber" name="82" href="#82">82</a>      <strong class="jxr_keyword">private</strong> ParameterService parameterService;
<a class="jxr_linenumber" name="83" href="#83">83</a>      <strong class="jxr_keyword">private</strong> <a href="../../../../../../org/kuali/kfs/pdp/dataaccess/FormatPaymentDao.html">FormatPaymentDao</a> formatPaymentDao;
<a class="jxr_linenumber" name="84" href="#84">84</a>      <strong class="jxr_keyword">private</strong> <a href="../../../../../../org/kuali/kfs/sys/batch/service/SchedulerService.html">SchedulerService</a> schedulerService;
<a class="jxr_linenumber" name="85" href="#85">85</a>      <strong class="jxr_keyword">private</strong> BusinessObjectService businessObjectService;
<a class="jxr_linenumber" name="86" href="#86">86</a>      <strong class="jxr_keyword">private</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/PaymentGroupService.html">PaymentGroupService</a> paymentGroupService;
<a class="jxr_linenumber" name="87" href="#87">87</a>      <strong class="jxr_keyword">private</strong> DateTimeService dateTimeService;
<a class="jxr_linenumber" name="88" href="#88">88</a>      <strong class="jxr_keyword">private</strong> <a href="../../../../../../org/kuali/kfs/pdp/batch/service/ExtractPaymentService.html">ExtractPaymentService</a> extractPaymentService;
<a class="jxr_linenumber" name="89" href="#89">89</a>      <strong class="jxr_keyword">private</strong> PersonService&lt;Person&gt; personService;
<a class="jxr_linenumber" name="90" href="#90">90</a>  
<a class="jxr_linenumber" name="91" href="#91">91</a>      <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="92" href="#92">92</a>  <em class="jxr_javadoccomment">     * Constructs a FormatServiceImpl.java.</em>
<a class="jxr_linenumber" name="93" href="#93">93</a>  <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="94" href="#94">94</a>      <strong class="jxr_keyword">public</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/impl/FormatServiceImpl.html">FormatServiceImpl</a>() {
<a class="jxr_linenumber" name="95" href="#95">95</a>          <strong class="jxr_keyword">super</strong>();
<a class="jxr_linenumber" name="96" href="#96">96</a>      }
<a class="jxr_linenumber" name="97" href="#97">97</a>  
<a class="jxr_linenumber" name="98" href="#98">98</a>      <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="99" href="#99">99</a>  <em class="jxr_javadoccomment">     * @see org.kuali.kfs.pdp.service.FormatProcessService#getDataForFormat(org.kuali.rice.kim.bo.Person)</em>
<a class="jxr_linenumber" name="100" href="#100">100</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="101" href="#101">101</a>     <strong class="jxr_keyword">public</strong> <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">FormatSelection</a> getDataForFormat(Person user) {
<a class="jxr_linenumber" name="102" href="#102">102</a> 
<a class="jxr_linenumber" name="103" href="#103">103</a>         String campusCode = user.getCampusCode();
<a class="jxr_linenumber" name="104" href="#104">104</a>         Date formatStartDate = getFormatProcessStartDate(campusCode);
<a class="jxr_linenumber" name="105" href="#105">105</a> 
<a class="jxr_linenumber" name="106" href="#106">106</a>         <em class="jxr_comment">// create new FormatSelection object an set the campus code and the start date</em>
<a class="jxr_linenumber" name="107" href="#107">107</a>         <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">FormatSelection</a> formatSelection = <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">FormatSelection</a>();
<a class="jxr_linenumber" name="108" href="#108">108</a>         formatSelection.setCampus(campusCode);
<a class="jxr_linenumber" name="109" href="#109">109</a>         formatSelection.setStartDate(formatStartDate);
<a class="jxr_linenumber" name="110" href="#110">110</a> 
<a class="jxr_linenumber" name="111" href="#111">111</a>         <em class="jxr_comment">// if format process not started yet, populate the other data as well</em>
<a class="jxr_linenumber" name="112" href="#112">112</a>         <strong class="jxr_keyword">if</strong> (formatStartDate == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="113" href="#113">113</a>             formatSelection.setCustomerList(getAllCustomerProfiles());
<a class="jxr_linenumber" name="114" href="#114">114</a>             formatSelection.setRangeList(getAllDisbursementNumberRanges());
<a class="jxr_linenumber" name="115" href="#115">115</a>         }
<a class="jxr_linenumber" name="116" href="#116">116</a> 
<a class="jxr_linenumber" name="117" href="#117">117</a>         <strong class="jxr_keyword">return</strong> formatSelection;
<a class="jxr_linenumber" name="118" href="#118">118</a>     }
<a class="jxr_linenumber" name="119" href="#119">119</a> 
<a class="jxr_linenumber" name="120" href="#120">120</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="121" href="#121">121</a> <em class="jxr_javadoccomment">     * @see org.kuali.kfs.pdp.service.FormatService#getFormatProcessStartDate(java.lang.String)</em>
<a class="jxr_linenumber" name="122" href="#122">122</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="123" href="#123">123</a>     @SuppressWarnings(<span class="jxr_string">"rawtypes"</span>)
<a class="jxr_linenumber" name="124" href="#124">124</a>     <strong class="jxr_keyword">public</strong> Date getFormatProcessStartDate(String campus) {
<a class="jxr_linenumber" name="125" href="#125">125</a>         LOG.debug(<span class="jxr_string">"getFormatProcessStartDate() started"</span>);
<a class="jxr_linenumber" name="126" href="#126">126</a> 
<a class="jxr_linenumber" name="127" href="#127">127</a>         Map primaryKeys = <strong class="jxr_keyword">new</strong> HashMap();
<a class="jxr_linenumber" name="128" href="#128">128</a>         primaryKeys.put(PdpPropertyConstants.PHYS_CAMPUS_PROCESS_CODE, campus);
<a class="jxr_linenumber" name="129" href="#129">129</a>         <a href="../../../../../../org/kuali/kfs/pdp/PdpParameterConstants.html">FormatProcess</a> formatProcess = (FormatProcess) <strong class="jxr_keyword">this</strong>.businessObjectService.findByPrimaryKey(FormatProcess.<strong class="jxr_keyword">class</strong>, primaryKeys);
<a class="jxr_linenumber" name="130" href="#130">130</a> 
<a class="jxr_linenumber" name="131" href="#131">131</a>         <strong class="jxr_keyword">if</strong> (formatProcess != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="132" href="#132">132</a>             LOG.debug(<span class="jxr_string">"getFormatProcessStartDate() found"</span>);
<a class="jxr_linenumber" name="133" href="#133">133</a>             <strong class="jxr_keyword">return</strong> <strong class="jxr_keyword">new</strong> Date(formatProcess.getBeginFormat().getTime());
<a class="jxr_linenumber" name="134" href="#134">134</a>         }
<a class="jxr_linenumber" name="135" href="#135">135</a>         <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="136" href="#136">136</a>             LOG.debug(<span class="jxr_string">"getFormatProcessStartDate() not found"</span>);
<a class="jxr_linenumber" name="137" href="#137">137</a>             <strong class="jxr_keyword">return</strong> <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="138" href="#138">138</a>         }
<a class="jxr_linenumber" name="139" href="#139">139</a>     }
<a class="jxr_linenumber" name="140" href="#140">140</a> 
<a class="jxr_linenumber" name="141" href="#141">141</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="142" href="#142">142</a> <em class="jxr_javadoccomment">     * @see org.kuali.kfs.pdp.service.FormatService#startFormatProcess(org.kuali.rice.kim.bo.Person, java.lang.String,</em>
<a class="jxr_linenumber" name="143" href="#143">143</a> <em class="jxr_javadoccomment">     *      java.util.List, java.util.Date, java.lang.String)</em>
<a class="jxr_linenumber" name="144" href="#144">144</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="145" href="#145">145</a>     <strong class="jxr_keyword">public</strong> <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">FormatProcessSummary</a> startFormatProcess(Person user, String campus, List&lt;CustomerProfile&gt; customers, Date paydate, String paymentTypes) {
<a class="jxr_linenumber" name="146" href="#146">146</a>         LOG.debug(<span class="jxr_string">"startFormatProcess() started"</span>);
<a class="jxr_linenumber" name="147" href="#147">147</a> 
<a class="jxr_linenumber" name="148" href="#148">148</a>         <strong class="jxr_keyword">for</strong> (CustomerProfile element : customers) {
<a class="jxr_linenumber" name="149" href="#149">149</a>             LOG.debug(<span class="jxr_string">"startFormatProcess() Customer: "</span> + element);
<a class="jxr_linenumber" name="150" href="#150">150</a>         }
<a class="jxr_linenumber" name="151" href="#151">151</a>         
<a class="jxr_linenumber" name="152" href="#152">152</a>         <em class="jxr_comment">// Create the process</em>
<a class="jxr_linenumber" name="153" href="#153">153</a>         Date d = <strong class="jxr_keyword">new</strong> Date();
<a class="jxr_linenumber" name="154" href="#154">154</a>         <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentProcess</a> paymentProcess = <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentProcess</a>();
<a class="jxr_linenumber" name="155" href="#155">155</a>         paymentProcess.setCampusCode(campus);
<a class="jxr_linenumber" name="156" href="#156">156</a>         paymentProcess.setProcessUser(user);
<a class="jxr_linenumber" name="157" href="#157">157</a>         paymentProcess.setProcessTimestamp(<strong class="jxr_keyword">new</strong> Timestamp(d.getTime()));
<a class="jxr_linenumber" name="158" href="#158">158</a> 
<a class="jxr_linenumber" name="159" href="#159">159</a>         <strong class="jxr_keyword">this</strong>.businessObjectService.save(paymentProcess);
<a class="jxr_linenumber" name="160" href="#160">160</a> 
<a class="jxr_linenumber" name="161" href="#161">161</a>         <em class="jxr_comment">// add an entry in the format process table (to lock the format process)</em>
<a class="jxr_linenumber" name="162" href="#162">162</a>         <a href="../../../../../../org/kuali/kfs/pdp/PdpParameterConstants.html">FormatProcess</a> formatProcess = <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/PdpParameterConstants.html">FormatProcess</a>();
<a class="jxr_linenumber" name="163" href="#163">163</a> 
<a class="jxr_linenumber" name="164" href="#164">164</a>         formatProcess.setPhysicalCampusProcessCode(campus);
<a class="jxr_linenumber" name="165" href="#165">165</a>         formatProcess.setBeginFormat(dateTimeService.getCurrentTimestamp());
<a class="jxr_linenumber" name="166" href="#166">166</a>         formatProcess.setPaymentProcIdentifier(paymentProcess.getId().intValue());
<a class="jxr_linenumber" name="167" href="#167">167</a> 
<a class="jxr_linenumber" name="168" href="#168">168</a>         <strong class="jxr_keyword">this</strong>.businessObjectService.save(formatProcess);
<a class="jxr_linenumber" name="169" href="#169">169</a> 
<a class="jxr_linenumber" name="170" href="#170">170</a>         <em class="jxr_comment">// Mark all of them ready for format</em>
<a class="jxr_linenumber" name="171" href="#171">171</a>         formatPaymentDao.markPaymentsForFormat(paymentProcess, customers, paydate, paymentTypes);
<a class="jxr_linenumber" name="172" href="#172">172</a> 
<a class="jxr_linenumber" name="173" href="#173">173</a>         <em class="jxr_comment">// summarize them</em>
<a class="jxr_linenumber" name="174" href="#174">174</a>         <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">FormatProcessSummary</a> preFormatProcessSummary = <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">FormatProcessSummary</a>();
<a class="jxr_linenumber" name="175" href="#175">175</a>         Iterator&lt;PaymentGroup&gt; iterator = <strong class="jxr_keyword">this</strong>.paymentGroupService.getByProcess(paymentProcess);
<a class="jxr_linenumber" name="176" href="#176">176</a> 
<a class="jxr_linenumber" name="177" href="#177">177</a>         <strong class="jxr_keyword">while</strong> (iterator.hasNext()) {
<a class="jxr_linenumber" name="178" href="#178">178</a>             <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentGroup</a> paymentGroup = iterator.next();
<a class="jxr_linenumber" name="179" href="#179">179</a>             preFormatProcessSummary.add(paymentGroup);
<a class="jxr_linenumber" name="180" href="#180">180</a>         }
<a class="jxr_linenumber" name="181" href="#181">181</a> 
<a class="jxr_linenumber" name="182" href="#182">182</a>         <em class="jxr_comment">// if no payments found for format clear the format process</em>
<a class="jxr_linenumber" name="183" href="#183">183</a>         <strong class="jxr_keyword">if</strong> (preFormatProcessSummary.getProcessSummaryList().size() == 0) {
<a class="jxr_linenumber" name="184" href="#184">184</a>             LOG.debug(<span class="jxr_string">"startFormatProcess() No payments to process.  Format process ending"</span>);
<a class="jxr_linenumber" name="185" href="#185">185</a>             clearUnfinishedFormat(paymentProcess.getId().intValue());<em class="jxr_comment">// ?? maybe call end format process</em>
<a class="jxr_linenumber" name="186" href="#186">186</a>         }
<a class="jxr_linenumber" name="187" href="#187">187</a> 
<a class="jxr_linenumber" name="188" href="#188">188</a>         <strong class="jxr_keyword">return</strong> preFormatProcessSummary;
<a class="jxr_linenumber" name="189" href="#189">189</a>     }
<a class="jxr_linenumber" name="190" href="#190">190</a> 
<a class="jxr_linenumber" name="191" href="#191">191</a> 
<a class="jxr_linenumber" name="192" href="#192">192</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="193" href="#193">193</a> <em class="jxr_javadoccomment">     * This method gets the maximum number of lines in a note.</em>
<a class="jxr_linenumber" name="194" href="#194">194</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="195" href="#195">195</a> <em class="jxr_javadoccomment">     * @return the maximum number of lines in a note</em>
<a class="jxr_linenumber" name="196" href="#196">196</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="197" href="#197">197</a>     <strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">int</strong> getMaxNoteLines() {
<a class="jxr_linenumber" name="198" href="#198">198</a>         String maxLines = parameterService.getParameterValue(KfsParameterConstants.PRE_DISBURSEMENT_ALL.<strong class="jxr_keyword">class</strong>, PdpParameterConstants.MAX_NOTE_LINES);
<a class="jxr_linenumber" name="199" href="#199">199</a>         <strong class="jxr_keyword">if</strong> (StringUtils.isBlank(maxLines)) {
<a class="jxr_linenumber" name="200" href="#200">200</a>             <strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> RuntimeException(<span class="jxr_string">"System parameter for max note lines is blank"</span>);
<a class="jxr_linenumber" name="201" href="#201">201</a>         }
<a class="jxr_linenumber" name="202" href="#202">202</a> 
<a class="jxr_linenumber" name="203" href="#203">203</a>         <strong class="jxr_keyword">return</strong> Integer.parseInt(maxLines);
<a class="jxr_linenumber" name="204" href="#204">204</a>     }
<a class="jxr_linenumber" name="205" href="#205">205</a> 
<a class="jxr_linenumber" name="206" href="#206">206</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="207" href="#207">207</a> <em class="jxr_javadoccomment">     * @see org.kuali.kfs.pdp.service.FormatService#performFormat(java.lang.Integer)</em>
<a class="jxr_linenumber" name="208" href="#208">208</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="209" href="#209">209</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> performFormat(Integer processId) <strong class="jxr_keyword">throws</strong> FormatException {
<a class="jxr_linenumber" name="210" href="#210">210</a>         LOG.debug(<span class="jxr_string">"performFormat() started"</span>);
<a class="jxr_linenumber" name="211" href="#211">211</a> 
<a class="jxr_linenumber" name="212" href="#212">212</a>         <em class="jxr_comment">// get the PaymentProcess for the given id</em>
<a class="jxr_linenumber" name="213" href="#213">213</a>         @SuppressWarnings(<span class="jxr_string">"rawtypes"</span>)
<a class="jxr_linenumber" name="214" href="#214">214</a>         Map primaryKeys = <strong class="jxr_keyword">new</strong> HashMap();
<a class="jxr_linenumber" name="215" href="#215">215</a>         primaryKeys.put(PdpPropertyConstants.PaymentProcess.PAYMENT_PROCESS_ID, processId);
<a class="jxr_linenumber" name="216" href="#216">216</a>         <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentProcess</a> paymentProcess = (PaymentProcess) <strong class="jxr_keyword">this</strong>.businessObjectService.findByPrimaryKey(PaymentProcess.<strong class="jxr_keyword">class</strong>, primaryKeys);
<a class="jxr_linenumber" name="217" href="#217">217</a>         <strong class="jxr_keyword">if</strong> (paymentProcess == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="218" href="#218">218</a>             LOG.error(<span class="jxr_string">"performFormat() Invalid proc ID "</span> + processId);
<a class="jxr_linenumber" name="219" href="#219">219</a>             <strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> RuntimeException(<span class="jxr_string">"Invalid proc ID"</span>);
<a class="jxr_linenumber" name="220" href="#220">220</a>         }
<a class="jxr_linenumber" name="221" href="#221">221</a>         
<a class="jxr_linenumber" name="222" href="#222">222</a>         String processCampus = paymentProcess.getCampusCode();
<a class="jxr_linenumber" name="223" href="#223">223</a>         <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">FormatProcessSummary</a> postFormatProcessSummary = <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">FormatProcessSummary</a>();
<a class="jxr_linenumber" name="224" href="#224">224</a> 
<a class="jxr_linenumber" name="225" href="#225">225</a>         <em class="jxr_comment">// step 1 get ACH or Check, Bank info, ACH info, sorting</em>
<a class="jxr_linenumber" name="226" href="#226">226</a>         Iterator&lt;PaymentGroup&gt; paymentGroupIterator = <strong class="jxr_keyword">this</strong>.paymentGroupService.getByProcess(paymentProcess);
<a class="jxr_linenumber" name="227" href="#227">227</a>         <strong class="jxr_keyword">while</strong> (paymentGroupIterator.hasNext()) {
<a class="jxr_linenumber" name="228" href="#228">228</a>             <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentGroup</a> paymentGroup = paymentGroupIterator.next();
<a class="jxr_linenumber" name="229" href="#229">229</a>             LOG.debug(<span class="jxr_string">"performFormat() Step 1 Payment Group ID "</span> + paymentGroup.getId());
<a class="jxr_linenumber" name="230" href="#230">230</a> 
<a class="jxr_linenumber" name="231" href="#231">231</a>             <em class="jxr_comment">// process payment group data</em>
<a class="jxr_linenumber" name="232" href="#232">232</a>             <strong class="jxr_keyword">boolean</strong> groupProcessed = processPaymentGroup(paymentGroup, paymentProcess);
<a class="jxr_linenumber" name="233" href="#233">233</a>             <strong class="jxr_keyword">if</strong> (!groupProcessed) {
<a class="jxr_linenumber" name="234" href="#234">234</a>                 <strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/impl/exception/FormatException.html">FormatException</a>(<span class="jxr_string">"Error encountered during format"</span>);
<a class="jxr_linenumber" name="235" href="#235">235</a>             }
<a class="jxr_linenumber" name="236" href="#236">236</a> 
<a class="jxr_linenumber" name="237" href="#237">237</a>             <em class="jxr_comment">// save payment group</em>
<a class="jxr_linenumber" name="238" href="#238">238</a>             <strong class="jxr_keyword">this</strong>.businessObjectService.save(paymentGroup);
<a class="jxr_linenumber" name="239" href="#239">239</a> 
<a class="jxr_linenumber" name="240" href="#240">240</a>             <em class="jxr_comment">// Add to summary information</em>
<a class="jxr_linenumber" name="241" href="#241">241</a>             postFormatProcessSummary.add(paymentGroup);
<a class="jxr_linenumber" name="242" href="#242">242</a>         }
<a class="jxr_linenumber" name="243" href="#243">243</a> 
<a class="jxr_linenumber" name="244" href="#244">244</a>         <em class="jxr_comment">// step 2 assign disbursement numbers and combine checks into one if possible</em>
<a class="jxr_linenumber" name="245" href="#245">245</a>         <strong class="jxr_keyword">boolean</strong> disbursementNumbersAssigned = assignDisbursementNumbersAndCombineChecks(paymentProcess, postFormatProcessSummary);
<a class="jxr_linenumber" name="246" href="#246">246</a>         <strong class="jxr_keyword">if</strong> (!disbursementNumbersAssigned) {
<a class="jxr_linenumber" name="247" href="#247">247</a>             <strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/impl/exception/FormatException.html">FormatException</a>(<span class="jxr_string">"Error encountered during format"</span>);
<a class="jxr_linenumber" name="248" href="#248">248</a>         }
<a class="jxr_linenumber" name="249" href="#249">249</a> 
<a class="jxr_linenumber" name="250" href="#250">250</a>         <em class="jxr_comment">// step 3 save the summarizing info</em>
<a class="jxr_linenumber" name="251" href="#251">251</a>         LOG.debug(<span class="jxr_string">"performFormat() Save summarizing information"</span>);
<a class="jxr_linenumber" name="252" href="#252">252</a>         postFormatProcessSummary.save();
<a class="jxr_linenumber" name="253" href="#253">253</a> 
<a class="jxr_linenumber" name="254" href="#254">254</a>         <em class="jxr_comment">// step 4 set formatted indicator to true and save in the db</em>
<a class="jxr_linenumber" name="255" href="#255">255</a>         paymentProcess.setFormattedIndicator(<strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="256" href="#256">256</a>         businessObjectService.save(paymentProcess);
<a class="jxr_linenumber" name="257" href="#257">257</a> 
<a class="jxr_linenumber" name="258" href="#258">258</a>         <em class="jxr_comment">// step 5 end the format process for this campus</em>
<a class="jxr_linenumber" name="259" href="#259">259</a>         LOG.debug(<span class="jxr_string">"performFormat() End the format process for this campus"</span>);
<a class="jxr_linenumber" name="260" href="#260">260</a>         endFormatProcess(processCampus);
<a class="jxr_linenumber" name="261" href="#261">261</a> 
<a class="jxr_linenumber" name="262" href="#262">262</a>         <em class="jxr_comment">// step 6 tell the extract batch job to start</em>
<a class="jxr_linenumber" name="263" href="#263">263</a>         LOG.debug(<span class="jxr_string">"performFormat() Start extract"</span>);
<a class="jxr_linenumber" name="264" href="#264">264</a>         extractChecks();
<a class="jxr_linenumber" name="265" href="#265">265</a>     }
<a class="jxr_linenumber" name="266" href="#266">266</a> 
<a class="jxr_linenumber" name="267" href="#267">267</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="268" href="#268">268</a> <em class="jxr_javadoccomment">     * This method processes the payment group data.</em>
<a class="jxr_linenumber" name="269" href="#269">269</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="270" href="#270">270</a> <em class="jxr_javadoccomment">     * @param paymentGroup</em>
<a class="jxr_linenumber" name="271" href="#271">271</a> <em class="jxr_javadoccomment">     * @param paymentProcess</em>
<a class="jxr_linenumber" name="272" href="#272">272</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="273" href="#273">273</a>     <strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">boolean</strong> processPaymentGroup(<a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentGroup</a> paymentGroup, <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentProcess</a> paymentProcess) {
<a class="jxr_linenumber" name="274" href="#274">274</a>         <strong class="jxr_keyword">boolean</strong> successful = <strong class="jxr_keyword">true</strong>;
<a class="jxr_linenumber" name="275" href="#275">275</a> 
<a class="jxr_linenumber" name="276" href="#276">276</a>         paymentGroup.setSortValue(paymentGroupService.getSortGroupId(paymentGroup));
<a class="jxr_linenumber" name="277" href="#277">277</a>         paymentGroup.setPhysCampusProcessCd(paymentProcess.getCampusCode());
<a class="jxr_linenumber" name="278" href="#278">278</a>         paymentGroup.setProcess(paymentProcess);
<a class="jxr_linenumber" name="279" href="#279">279</a> 
<a class="jxr_linenumber" name="280" href="#280">280</a>         <em class="jxr_comment">// If any one of the payment details in the group are negative, we always force a check</em>
<a class="jxr_linenumber" name="281" href="#281">281</a>         <strong class="jxr_keyword">boolean</strong> noNegativeDetails = <strong class="jxr_keyword">true</strong>;
<a class="jxr_linenumber" name="282" href="#282">282</a> 
<a class="jxr_linenumber" name="283" href="#283">283</a>         <em class="jxr_comment">// If any one of the payment details in the group are negative, we always force a check</em>
<a class="jxr_linenumber" name="284" href="#284">284</a>         List&lt;PaymentDetail&gt; paymentDetailsList = paymentGroup.getPaymentDetails();
<a class="jxr_linenumber" name="285" href="#285">285</a>         <strong class="jxr_keyword">for</strong> (PaymentDetail paymentDetail : paymentDetailsList) {
<a class="jxr_linenumber" name="286" href="#286">286</a>             <strong class="jxr_keyword">if</strong> (paymentDetail.getNetPaymentAmount().doubleValue() &lt; 0) {
<a class="jxr_linenumber" name="287" href="#287">287</a>                 LOG.debug(<span class="jxr_string">"performFormat() Payment Group "</span> + paymentGroup + <span class="jxr_string">" has payment detail net payment amount "</span> + paymentDetail.getNetPaymentAmount());
<a class="jxr_linenumber" name="288" href="#288">288</a>                 LOG.debug(<span class="jxr_string">"performFormat() Forcing a Check for Group"</span>);
<a class="jxr_linenumber" name="289" href="#289">289</a>                 noNegativeDetails = false;
<a class="jxr_linenumber" name="290" href="#290">290</a>                 <strong class="jxr_keyword">break</strong>;
<a class="jxr_linenumber" name="291" href="#291">291</a>             }
<a class="jxr_linenumber" name="292" href="#292">292</a>         }
<a class="jxr_linenumber" name="293" href="#293">293</a> 
<a class="jxr_linenumber" name="294" href="#294">294</a>         <em class="jxr_comment">// determine whether payment should be ACH or Check</em>
<a class="jxr_linenumber" name="295" href="#295">295</a>         <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">CustomerProfile</a> customer = paymentGroup.getBatch().getCustomerProfile();
<a class="jxr_linenumber" name="296" href="#296">296</a>         
<a class="jxr_linenumber" name="297" href="#297">297</a>         <a href="../../../../../../org/kuali/kfs/pdp/businessobject/PayeeACHAccount.html">PayeeACHAccount</a> payeeAchAccount = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="298" href="#298">298</a>         <strong class="jxr_keyword">boolean</strong> isCheck = <strong class="jxr_keyword">true</strong>;
<a class="jxr_linenumber" name="299" href="#299">299</a>         <strong class="jxr_keyword">if</strong> (PdpConstants.PayeeIdTypeCodes.VENDOR_ID.equals(paymentGroup.getPayeeIdTypeCd()) || PdpConstants.PayeeIdTypeCodes.EMPLOYEE.equals(paymentGroup.getPayeeIdTypeCd()) || PdpConstants.PayeeIdTypeCodes.ENTITY.equals(paymentGroup.getPayeeIdTypeCd())) {
<a class="jxr_linenumber" name="300" href="#300">300</a>             <strong class="jxr_keyword">if</strong> (StringUtils.isNotBlank(paymentGroup.getPayeeId()) &amp;&amp; !paymentGroup.getPymtAttachment() &amp;&amp; !paymentGroup.getProcessImmediate() &amp;&amp; !paymentGroup.getPymtSpecialHandling() &amp;&amp; (customer.getAchTransactionType() != <strong class="jxr_keyword">null</strong>) &amp;&amp; noNegativeDetails) {
<a class="jxr_linenumber" name="301" href="#301">301</a>                 LOG.debug(<span class="jxr_string">"performFormat() Checking ACH"</span>);
<a class="jxr_linenumber" name="302" href="#302">302</a>                 payeeAchAccount = achService.getAchInformation(paymentGroup.getPayeeIdTypeCd(), paymentGroup.getPayeeId(), customer.getAchTransactionType());
<a class="jxr_linenumber" name="303" href="#303">303</a>                 isCheck = (payeeAchAccount == <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="304" href="#304">304</a>             }
<a class="jxr_linenumber" name="305" href="#305">305</a>         }
<a class="jxr_linenumber" name="306" href="#306">306</a> 
<a class="jxr_linenumber" name="307" href="#307">307</a>         <a href="../../../../../../org/kuali/kfs/pdp/businessobject/DisbursementType.html">DisbursementType</a> disbursementType = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="308" href="#308">308</a>         <strong class="jxr_keyword">if</strong> (isCheck) {
<a class="jxr_linenumber" name="309" href="#309">309</a>             <a href="../../../../../../org/kuali/kfs/pdp/businessobject/PaymentStatus.html">PaymentStatus</a> paymentStatus = (PaymentStatus) businessObjectService.findBySinglePrimaryKey(PaymentStatus.<strong class="jxr_keyword">class</strong>, PdpConstants.PaymentStatusCodes.PENDING_CHECK);
<a class="jxr_linenumber" name="310" href="#310">310</a>             paymentGroup.setPaymentStatus(paymentStatus);
<a class="jxr_linenumber" name="311" href="#311">311</a> 
<a class="jxr_linenumber" name="312" href="#312">312</a>             disbursementType = (DisbursementType) businessObjectService.findBySinglePrimaryKey(DisbursementType.<strong class="jxr_keyword">class</strong>, PdpConstants.DisbursementTypeCodes.CHECK);
<a class="jxr_linenumber" name="313" href="#313">313</a>             paymentGroup.setDisbursementType(disbursementType);
<a class="jxr_linenumber" name="314" href="#314">314</a>         }
<a class="jxr_linenumber" name="315" href="#315">315</a>         <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="316" href="#316">316</a>             <a href="../../../../../../org/kuali/kfs/pdp/businessobject/PaymentStatus.html">PaymentStatus</a> paymentStatus = (PaymentStatus) businessObjectService.findBySinglePrimaryKey(PaymentStatus.<strong class="jxr_keyword">class</strong>, PdpConstants.PaymentStatusCodes.PENDING_ACH);
<a class="jxr_linenumber" name="317" href="#317">317</a>             paymentGroup.setPaymentStatus(paymentStatus);
<a class="jxr_linenumber" name="318" href="#318">318</a>             
<a class="jxr_linenumber" name="319" href="#319">319</a>             disbursementType = (DisbursementType) businessObjectService.findBySinglePrimaryKey(DisbursementType.<strong class="jxr_keyword">class</strong>, PdpConstants.DisbursementTypeCodes.ACH);
<a class="jxr_linenumber" name="320" href="#320">320</a>             paymentGroup.setDisbursementType(disbursementType);
<a class="jxr_linenumber" name="321" href="#321">321</a> 
<a class="jxr_linenumber" name="322" href="#322">322</a>             paymentGroup.setAchBankRoutingNbr(payeeAchAccount.getBankRoutingNumber());
<a class="jxr_linenumber" name="323" href="#323">323</a>             paymentGroup.setAdviceEmailAddress(payeeAchAccount.getPayeeEmailAddress());
<a class="jxr_linenumber" name="324" href="#324">324</a>             paymentGroup.setAchAccountType(payeeAchAccount.getBankAccountTypeCode());
<a class="jxr_linenumber" name="325" href="#325">325</a> 
<a class="jxr_linenumber" name="326" href="#326">326</a>             <a href="../../../../../../org/kuali/kfs/pdp/businessobject/AchAccountNumber.html">AchAccountNumber</a> achAccountNumber = <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/businessobject/AchAccountNumber.html">AchAccountNumber</a>();
<a class="jxr_linenumber" name="327" href="#327">327</a>             achAccountNumber.setAchBankAccountNbr(payeeAchAccount.getBankAccountNumber());
<a class="jxr_linenumber" name="328" href="#328">328</a>             achAccountNumber.setId(paymentGroup.getId());
<a class="jxr_linenumber" name="329" href="#329">329</a>             paymentGroup.setAchAccountNumber(achAccountNumber);
<a class="jxr_linenumber" name="330" href="#330">330</a>         }
<a class="jxr_linenumber" name="331" href="#331">331</a>         
<a class="jxr_linenumber" name="332" href="#332">332</a>         <em class="jxr_comment">// set payment group bank</em>
<a class="jxr_linenumber" name="333" href="#333">333</a>         successful &amp;= validateAndUpdatePaymentGroupBankCode(paymentGroup, disbursementType, customer);
<a class="jxr_linenumber" name="334" href="#334">334</a>         
<a class="jxr_linenumber" name="335" href="#335">335</a>         <strong class="jxr_keyword">return</strong> successful;
<a class="jxr_linenumber" name="336" href="#336">336</a>     }
<a class="jxr_linenumber" name="337" href="#337">337</a>     
<a class="jxr_linenumber" name="338" href="#338">338</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="339" href="#339">339</a> <em class="jxr_javadoccomment">     * Verifies a valid bank is set on the payment group. A bank is valid if it is active and supports the given disbursement type. If the payment group already has an</em>
<a class="jxr_linenumber" name="340" href="#340">340</a> <em class="jxr_javadoccomment">     * assigned bank it will be used unless it is not valid. If the payment group bank is not valid or was not given the bank specified on the customer profile to use</em>
<a class="jxr_linenumber" name="341" href="#341">341</a> <em class="jxr_javadoccomment">     * for the given disbursement type is used. If this bank is inactive then its continuation bank is used. If not valid bank to use is found an error is added to the</em>
<a class="jxr_linenumber" name="342" href="#342">342</a> <em class="jxr_javadoccomment">     * global message map.</em>
<a class="jxr_linenumber" name="343" href="#343">343</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="344" href="#344">344</a> <em class="jxr_javadoccomment">     * @param paymentGroup group to set bank on</em>
<a class="jxr_linenumber" name="345" href="#345">345</a> <em class="jxr_javadoccomment">     * @param disbursementType type of disbursement for given payment group</em>
<a class="jxr_linenumber" name="346" href="#346">346</a> <em class="jxr_javadoccomment">     * @param customer customer profile for payment group</em>
<a class="jxr_linenumber" name="347" href="#347">347</a> <em class="jxr_javadoccomment">     * @return boolean true if a valid bank is set on the payment group, false otherwise</em>
<a class="jxr_linenumber" name="348" href="#348">348</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="349" href="#349">349</a>     <strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">boolean</strong> validateAndUpdatePaymentGroupBankCode(<a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentGroup</a> paymentGroup, <a href="../../../../../../org/kuali/kfs/pdp/businessobject/DisbursementType.html">DisbursementType</a> disbursementType, <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">CustomerProfile</a> customer) {
<a class="jxr_linenumber" name="350" href="#350">350</a>         <strong class="jxr_keyword">boolean</strong> bankValid = <strong class="jxr_keyword">true</strong>;
<a class="jxr_linenumber" name="351" href="#351">351</a>         
<a class="jxr_linenumber" name="352" href="#352">352</a>         String originalBankCode = paymentGroup.getBankCode();
<a class="jxr_linenumber" name="353" href="#353">353</a>         <strong class="jxr_keyword">if</strong> (ObjectUtils.isNull(paymentGroup.getBank()) || ((disbursementType.getCode().equals(PdpConstants.DisbursementTypeCodes.ACH) &amp;&amp; !paymentGroup.getBank().isBankAchIndicator()) || (disbursementType.getCode().equals(PdpConstants.DisbursementTypeCodes.CHECK) &amp;&amp; !paymentGroup.getBank().isBankCheckIndicator())) || !paymentGroup.getBank().isActive()) {
<a class="jxr_linenumber" name="354" href="#354">354</a>             <a href="../../../../../../org/kuali/kfs/pdp/businessobject/CustomerBank.html">CustomerBank</a> customerBank = customer.getCustomerBankByDisbursementType(disbursementType.getCode());
<a class="jxr_linenumber" name="355" href="#355">355</a>             <strong class="jxr_keyword">if</strong> (ObjectUtils.isNotNull(customerBank) &amp;&amp; customerBank.isActive() &amp;&amp; ObjectUtils.isNotNull(customerBank.getBank()) &amp;&amp; customerBank.getBank().isActive()) {
<a class="jxr_linenumber" name="356" href="#356">356</a>                 paymentGroup.setBankCode(customerBank.getBankCode());
<a class="jxr_linenumber" name="357" href="#357">357</a>                 paymentGroup.setBank(customerBank.getBank());
<a class="jxr_linenumber" name="358" href="#358">358</a>             }
<a class="jxr_linenumber" name="359" href="#359">359</a>             <strong class="jxr_keyword">else</strong> <strong class="jxr_keyword">if</strong> (ObjectUtils.isNotNull(customerBank) &amp;&amp; ObjectUtils.isNotNull(customerBank.getBank()) &amp;&amp; ObjectUtils.isNotNull(customerBank.getBank().getContinuationBank()) &amp;&amp; customerBank.getBank().getContinuationBank().isActive()) {
<a class="jxr_linenumber" name="360" href="#360">360</a>                 paymentGroup.setBankCode(customerBank.getBank().getContinuationBank().getBankCode());
<a class="jxr_linenumber" name="361" href="#361">361</a>                 paymentGroup.setBank(customerBank.getBank().getContinuationBank());
<a class="jxr_linenumber" name="362" href="#362">362</a>             }
<a class="jxr_linenumber" name="363" href="#363">363</a>         }
<a class="jxr_linenumber" name="364" href="#364">364</a> 
<a class="jxr_linenumber" name="365" href="#365">365</a>         <strong class="jxr_keyword">if</strong> (ObjectUtils.isNull(paymentGroup.getBank())) {
<a class="jxr_linenumber" name="366" href="#366">366</a>             LOG.error(<span class="jxr_string">"performFormat() A bank is needed for "</span> + disbursementType.getName() + <span class="jxr_string">" disbursement type for customer: "</span> + customer);
<a class="jxr_linenumber" name="367" href="#367">367</a>             GlobalVariables.getMessageMap().putError(KFSConstants.GLOBAL_ERRORS, PdpKeyConstants.Format.ErrorMessages.ERROR_FORMAT_BANK_MISSING, customer.getCustomerShortName());
<a class="jxr_linenumber" name="368" href="#368">368</a>             bankValid = false;
<a class="jxr_linenumber" name="369" href="#369">369</a>             
<a class="jxr_linenumber" name="370" href="#370">370</a>             <strong class="jxr_keyword">return</strong> bankValid;
<a class="jxr_linenumber" name="371" href="#371">371</a>         }
<a class="jxr_linenumber" name="372" href="#372">372</a>         
<a class="jxr_linenumber" name="373" href="#373">373</a>         <em class="jxr_comment">// create payment history record if bank was changed</em>
<a class="jxr_linenumber" name="374" href="#374">374</a>         <strong class="jxr_keyword">if</strong> (StringUtils.isNotBlank(originalBankCode) &amp;&amp; !paymentGroup.getBankCode().equals(originalBankCode)) {
<a class="jxr_linenumber" name="375" href="#375">375</a>             <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentGroupHistory</a> paymentGroupHistory = <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentGroupHistory</a>();
<a class="jxr_linenumber" name="376" href="#376">376</a> 
<a class="jxr_linenumber" name="377" href="#377">377</a>             <a href="../../../../../../org/kuali/kfs/pdp/businessobject/PaymentChangeCode.html">PaymentChangeCode</a> paymentChangeCode = (PaymentChangeCode) businessObjectService.findBySinglePrimaryKey(PaymentChangeCode.<strong class="jxr_keyword">class</strong>, PdpConstants.PaymentChangeCodes.BANK_CHNG_CD);
<a class="jxr_linenumber" name="378" href="#378">378</a>             paymentGroupHistory.setPaymentChange(paymentChangeCode);
<a class="jxr_linenumber" name="379" href="#379">379</a>             paymentGroupHistory.setOrigBankCode(originalBankCode);
<a class="jxr_linenumber" name="380" href="#380">380</a>             
<a class="jxr_linenumber" name="381" href="#381">381</a>             <a href="../../../../../../org/kuali/kfs/sys/KFSKeyConstants.html">Bank</a> originalBank = (Bank) businessObjectService.findBySinglePrimaryKey(Bank.<strong class="jxr_keyword">class</strong>, originalBankCode);
<a class="jxr_linenumber" name="382" href="#382">382</a>             paymentGroupHistory.setBank(originalBank);
<a class="jxr_linenumber" name="383" href="#383">383</a>             paymentGroupHistory.setOrigPaymentStatus(paymentGroup.getPaymentStatus());
<a class="jxr_linenumber" name="384" href="#384">384</a>             
<a class="jxr_linenumber" name="385" href="#385">385</a>             Person changeUser = getPersonService().getPerson(KFSConstants.SYSTEM_USER);
<a class="jxr_linenumber" name="386" href="#386">386</a>             paymentGroupHistory.setChangeUser(changeUser);
<a class="jxr_linenumber" name="387" href="#387">387</a>             paymentGroupHistory.setPaymentGroup(paymentGroup);
<a class="jxr_linenumber" name="388" href="#388">388</a>             paymentGroupHistory.setChangeTime(<strong class="jxr_keyword">new</strong> Timestamp(<strong class="jxr_keyword">new</strong> Date().getTime()));
<a class="jxr_linenumber" name="389" href="#389">389</a> 
<a class="jxr_linenumber" name="390" href="#390">390</a>             <em class="jxr_comment">// save payment group history</em>
<a class="jxr_linenumber" name="391" href="#391">391</a>             businessObjectService.save(paymentGroupHistory);
<a class="jxr_linenumber" name="392" href="#392">392</a>         }
<a class="jxr_linenumber" name="393" href="#393">393</a>         
<a class="jxr_linenumber" name="394" href="#394">394</a>         <strong class="jxr_keyword">return</strong> bankValid;
<a class="jxr_linenumber" name="395" href="#395">395</a>     }
<a class="jxr_linenumber" name="396" href="#396">396</a> 
<a class="jxr_linenumber" name="397" href="#397">397</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="398" href="#398">398</a> <em class="jxr_javadoccomment">     * This method assigns disbursement numbers and tries to combine payment groups with disbursement type check if possible.</em>
<a class="jxr_linenumber" name="399" href="#399">399</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="400" href="#400">400</a> <em class="jxr_javadoccomment">     * @param paymentProcess</em>
<a class="jxr_linenumber" name="401" href="#401">401</a> <em class="jxr_javadoccomment">     * @param postFormatProcessSummary</em>
<a class="jxr_linenumber" name="402" href="#402">402</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="403" href="#403">403</a>     <strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">boolean</strong> assignDisbursementNumbersAndCombineChecks(<a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentProcess</a> paymentProcess, <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">FormatProcessSummary</a> postFormatProcessSummary) {
<a class="jxr_linenumber" name="404" href="#404">404</a>         <strong class="jxr_keyword">boolean</strong> successful = <strong class="jxr_keyword">true</strong>;
<a class="jxr_linenumber" name="405" href="#405">405</a> 
<a class="jxr_linenumber" name="406" href="#406">406</a>         <em class="jxr_comment">// keep a map with paymentGroupKey and PaymentInfo (disbursementNumber, noteLines)</em>
<a class="jxr_linenumber" name="407" href="#407">407</a>         Map&lt;String, PaymentInfo&gt; combinedChecksMap = <strong class="jxr_keyword">new</strong> HashMap&lt;String, PaymentInfo&gt;();
<a class="jxr_linenumber" name="408" href="#408">408</a> 
<a class="jxr_linenumber" name="409" href="#409">409</a>         Iterator&lt;PaymentGroup&gt; paymentGroupIterator = <strong class="jxr_keyword">this</strong>.paymentGroupService.getByProcess(paymentProcess);
<a class="jxr_linenumber" name="410" href="#410">410</a>         <strong class="jxr_keyword">int</strong> maxNoteLines = getMaxNoteLines();
<a class="jxr_linenumber" name="411" href="#411">411</a> 
<a class="jxr_linenumber" name="412" href="#412">412</a>         <strong class="jxr_keyword">while</strong> (paymentGroupIterator.hasNext()) {
<a class="jxr_linenumber" name="413" href="#413">413</a>             <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentGroup</a> paymentGroup = paymentGroupIterator.next();
<a class="jxr_linenumber" name="414" href="#414">414</a>             LOG.debug(<span class="jxr_string">"performFormat() Payment Group ID "</span> + paymentGroup.getId());
<a class="jxr_linenumber" name="415" href="#415">415</a> 
<a class="jxr_linenumber" name="416" href="#416">416</a>             <em class="jxr_comment">//Use the customer's profile's campus code to check for disbursement ranges</em>
<a class="jxr_linenumber" name="417" href="#417">417</a>             String campus = paymentGroup.getBatch().getCustomerProfile().getDefaultPhysicalCampusProcessingCode();
<a class="jxr_linenumber" name="418" href="#418">418</a>             List&lt;DisbursementNumberRange&gt; disbursementRanges = paymentDetailDao.getDisbursementNumberRanges(campus);
<a class="jxr_linenumber" name="419" href="#419">419</a>             
<a class="jxr_linenumber" name="420" href="#420">420</a>             <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">DisbursementNumberRange</a> range = getRange(disbursementRanges, paymentGroup.getBank(), paymentGroup.getDisbursementType().getCode());
<a class="jxr_linenumber" name="421" href="#421">421</a> 
<a class="jxr_linenumber" name="422" href="#422">422</a>             <strong class="jxr_keyword">if</strong> (range == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="423" href="#423">423</a>                 GlobalVariables.getMessageMap().putError(KFSConstants.GLOBAL_ERRORS, PdpKeyConstants.Format.ErrorMessages.ERROR_FORMAT_DISBURSEMENT_MISSING, campus, paymentGroup.getBank().getBankCode(), paymentGroup.getDisbursementType().getCode());
<a class="jxr_linenumber" name="424" href="#424">424</a>                 successful = false;
<a class="jxr_linenumber" name="425" href="#425">425</a>                 <strong class="jxr_keyword">return</strong> successful;
<a class="jxr_linenumber" name="426" href="#426">426</a>             }
<a class="jxr_linenumber" name="427" href="#427">427</a> 
<a class="jxr_linenumber" name="428" href="#428">428</a>             <strong class="jxr_keyword">if</strong> (PdpConstants.DisbursementTypeCodes.CHECK.equals(paymentGroup.getDisbursementType().getCode())) {
<a class="jxr_linenumber" name="429" href="#429">429</a> 
<a class="jxr_linenumber" name="430" href="#430">430</a>                 <strong class="jxr_keyword">if</strong> (paymentGroup.getPymtAttachment().booleanValue() || paymentGroup.getProcessImmediate().booleanValue() || paymentGroup.getPymtSpecialHandling().booleanValue() || (!paymentGroup.getCombineGroups())) {
<a class="jxr_linenumber" name="431" href="#431">431</a>                     assignDisbursementNumber(campus, range, paymentGroup, postFormatProcessSummary);
<a class="jxr_linenumber" name="432" href="#432">432</a>                 }
<a class="jxr_linenumber" name="433" href="#433">433</a>                 <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="434" href="#434">434</a>                     String paymentGroupKey = paymentGroup.toStringKey();
<a class="jxr_linenumber" name="435" href="#435">435</a>                     <em class="jxr_comment">// check if there was another paymentGroup we can combine with</em>
<a class="jxr_linenumber" name="436" href="#436">436</a>                     <strong class="jxr_keyword">if</strong> (combinedChecksMap.containsKey(paymentGroupKey)) {
<a class="jxr_linenumber" name="437" href="#437">437</a>                         <a href="../../../../../../org/kuali/kfs/pdp/service/impl/FormatServiceImpl.html">PaymentInfo</a> paymentInfo = combinedChecksMap.get(paymentGroupKey);
<a class="jxr_linenumber" name="438" href="#438">438</a>                         paymentInfo.noteLines = paymentInfo.noteLines.add(<strong class="jxr_keyword">new</strong> KualiInteger(paymentGroup.getNoteLines()));
<a class="jxr_linenumber" name="439" href="#439">439</a> 
<a class="jxr_linenumber" name="440" href="#440">440</a>                         <em class="jxr_comment">// if noteLines don't excede the maximum assign the same disbursementNumber</em>
<a class="jxr_linenumber" name="441" href="#441">441</a>                         <strong class="jxr_keyword">if</strong> (paymentInfo.noteLines.intValue() &lt;= maxNoteLines) {
<a class="jxr_linenumber" name="442" href="#442">442</a>                             KualiInteger checkNumber = paymentInfo.disbursementNumber;
<a class="jxr_linenumber" name="443" href="#443">443</a>                             paymentGroup.setDisbursementNbr(checkNumber);
<a class="jxr_linenumber" name="444" href="#444">444</a> 
<a class="jxr_linenumber" name="445" href="#445">445</a>                             <em class="jxr_comment">// update payment info for new noteLines value</em>
<a class="jxr_linenumber" name="446" href="#446">446</a>                             combinedChecksMap.put(paymentGroupKey, paymentInfo);
<a class="jxr_linenumber" name="447" href="#447">447</a>                         }
<a class="jxr_linenumber" name="448" href="#448">448</a>                         <em class="jxr_comment">// it noteLines more than maxNoteLines we remove the old entry and get a new disbursement number</em>
<a class="jxr_linenumber" name="449" href="#449">449</a>                         <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="450" href="#450">450</a>                             <em class="jxr_comment">// remove old entry for this paymentGroupKey</em>
<a class="jxr_linenumber" name="451" href="#451">451</a>                             combinedChecksMap.remove(paymentGroupKey);
<a class="jxr_linenumber" name="452" href="#452">452</a> 
<a class="jxr_linenumber" name="453" href="#453">453</a>                             <em class="jxr_comment">// get a new check number and the paymentGroup noteLines</em>
<a class="jxr_linenumber" name="454" href="#454">454</a>                             KualiInteger checkNumber = assignDisbursementNumber(campus, range, paymentGroup, postFormatProcessSummary);
<a class="jxr_linenumber" name="455" href="#455">455</a>                             <strong class="jxr_keyword">int</strong> noteLines = paymentGroup.getNoteLines();
<a class="jxr_linenumber" name="456" href="#456">456</a> 
<a class="jxr_linenumber" name="457" href="#457">457</a>                             <em class="jxr_comment">// create new payment info with these two</em>
<a class="jxr_linenumber" name="458" href="#458">458</a>                             paymentInfo = <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/impl/FormatServiceImpl.html">PaymentInfo</a>(checkNumber, <strong class="jxr_keyword">new</strong> KualiInteger(noteLines));
<a class="jxr_linenumber" name="459" href="#459">459</a> 
<a class="jxr_linenumber" name="460" href="#460">460</a>                             <em class="jxr_comment">// add new entry in the map for this paymentGroupKey</em>
<a class="jxr_linenumber" name="461" href="#461">461</a>                             combinedChecksMap.put(paymentGroupKey, paymentInfo);
<a class="jxr_linenumber" name="462" href="#462">462</a> 
<a class="jxr_linenumber" name="463" href="#463">463</a>                         }
<a class="jxr_linenumber" name="464" href="#464">464</a>                     }
<a class="jxr_linenumber" name="465" href="#465">465</a>                     <em class="jxr_comment">// if no entry in the map for this payment group we create a new one</em>
<a class="jxr_linenumber" name="466" href="#466">466</a>                     <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="467" href="#467">467</a>                         <em class="jxr_comment">// get a new check number and the paymentGroup noteLines</em>
<a class="jxr_linenumber" name="468" href="#468">468</a>                         KualiInteger checkNumber = assignDisbursementNumber(campus, range, paymentGroup, postFormatProcessSummary);
<a class="jxr_linenumber" name="469" href="#469">469</a>                         <strong class="jxr_keyword">int</strong> noteLines = paymentGroup.getNoteLines();
<a class="jxr_linenumber" name="470" href="#470">470</a> 
<a class="jxr_linenumber" name="471" href="#471">471</a>                         <em class="jxr_comment">// create new payment info with these two</em>
<a class="jxr_linenumber" name="472" href="#472">472</a>                         <a href="../../../../../../org/kuali/kfs/pdp/service/impl/FormatServiceImpl.html">PaymentInfo</a> paymentInfo = <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/impl/FormatServiceImpl.html">PaymentInfo</a>(checkNumber, <strong class="jxr_keyword">new</strong> KualiInteger(noteLines));
<a class="jxr_linenumber" name="473" href="#473">473</a> 
<a class="jxr_linenumber" name="474" href="#474">474</a>                         <em class="jxr_comment">// add new entry in the map for this paymentGroupKey</em>
<a class="jxr_linenumber" name="475" href="#475">475</a>                         combinedChecksMap.put(paymentGroupKey, paymentInfo);
<a class="jxr_linenumber" name="476" href="#476">476</a>                     }
<a class="jxr_linenumber" name="477" href="#477">477</a>                 }
<a class="jxr_linenumber" name="478" href="#478">478</a>             }
<a class="jxr_linenumber" name="479" href="#479">479</a>             <strong class="jxr_keyword">else</strong> <strong class="jxr_keyword">if</strong> (PdpConstants.DisbursementTypeCodes.ACH.equals(paymentGroup.getDisbursementType().getCode())) {
<a class="jxr_linenumber" name="480" href="#480">480</a>                 assignDisbursementNumber(campus, range, paymentGroup, postFormatProcessSummary);
<a class="jxr_linenumber" name="481" href="#481">481</a>             }
<a class="jxr_linenumber" name="482" href="#482">482</a>             <strong class="jxr_keyword">else</strong> {
<a class="jxr_linenumber" name="483" href="#483">483</a>                 <em class="jxr_comment">// if it isn't check or ach, we're in trouble</em>
<a class="jxr_linenumber" name="484" href="#484">484</a>                 LOG.error(<span class="jxr_string">"assignDisbursementNumbers() Payment group "</span> + paymentGroup.getId() + <span class="jxr_string">" must be CHCK or ACH.  It is: "</span> + paymentGroup.getDisbursementType());
<a class="jxr_linenumber" name="485" href="#485">485</a>                 <strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> IllegalArgumentException(<span class="jxr_string">"Payment group "</span> + paymentGroup.getId() + <span class="jxr_string">" must be Check or ACH"</span>);
<a class="jxr_linenumber" name="486" href="#486">486</a>             }
<a class="jxr_linenumber" name="487" href="#487">487</a> 
<a class="jxr_linenumber" name="488" href="#488">488</a>             <strong class="jxr_keyword">this</strong>.businessObjectService.save(paymentGroup);
<a class="jxr_linenumber" name="489" href="#489">489</a> 
<a class="jxr_linenumber" name="490" href="#490">490</a>             <em class="jxr_comment">// Generate a GL entry for CHCK &amp; ACH</em>
<a class="jxr_linenumber" name="491" href="#491">491</a>             glPendingTransactionService.generatePaymentGeneralLedgerPendingEntry(paymentGroup);
<a class="jxr_linenumber" name="492" href="#492">492</a>             
<a class="jxr_linenumber" name="493" href="#493">493</a>             <em class="jxr_comment">// Update all the ranges</em>
<a class="jxr_linenumber" name="494" href="#494">494</a>             LOG.debug(<span class="jxr_string">"assignDisbursementNumbers() Save ranges"</span>);
<a class="jxr_linenumber" name="495" href="#495">495</a>             <strong class="jxr_keyword">for</strong> (DisbursementNumberRange element : disbursementRanges) {
<a class="jxr_linenumber" name="496" href="#496">496</a>                 <strong class="jxr_keyword">this</strong>.businessObjectService.save(element);
<a class="jxr_linenumber" name="497" href="#497">497</a>             }
<a class="jxr_linenumber" name="498" href="#498">498</a>         }
<a class="jxr_linenumber" name="499" href="#499">499</a> 
<a class="jxr_linenumber" name="500" href="#500">500</a>         <strong class="jxr_keyword">return</strong> successful;
<a class="jxr_linenumber" name="501" href="#501">501</a>     }
<a class="jxr_linenumber" name="502" href="#502">502</a> 
<a class="jxr_linenumber" name="503" href="#503">503</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="504" href="#504">504</a> <em class="jxr_javadoccomment">     * This method gets a new disbursement number and sets it on the payment group and process summary.</em>
<a class="jxr_linenumber" name="505" href="#505">505</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="506" href="#506">506</a> <em class="jxr_javadoccomment">     * @param campus</em>
<a class="jxr_linenumber" name="507" href="#507">507</a> <em class="jxr_javadoccomment">     * @param range</em>
<a class="jxr_linenumber" name="508" href="#508">508</a> <em class="jxr_javadoccomment">     * @param paymentGroup</em>
<a class="jxr_linenumber" name="509" href="#509">509</a> <em class="jxr_javadoccomment">     * @param postFormatProcessSummary</em>
<a class="jxr_linenumber" name="510" href="#510">510</a> <em class="jxr_javadoccomment">     * @return</em>
<a class="jxr_linenumber" name="511" href="#511">511</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="512" href="#512">512</a>     <strong class="jxr_keyword">protected</strong> KualiInteger assignDisbursementNumber(String campus, <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">DisbursementNumberRange</a> range, <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentGroup</a> paymentGroup, <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">FormatProcessSummary</a> postFormatProcessSummary) {
<a class="jxr_linenumber" name="513" href="#513">513</a>         KualiInteger disbursementNumber = <strong class="jxr_keyword">new</strong> KualiInteger(1 + range.getLastAssignedDisbNbr().intValue());
<a class="jxr_linenumber" name="514" href="#514">514</a> 
<a class="jxr_linenumber" name="515" href="#515">515</a>         <strong class="jxr_keyword">if</strong> (disbursementNumber.isGreaterThan(range.getEndDisbursementNbr())) {
<a class="jxr_linenumber" name="516" href="#516">516</a>             GlobalVariables.getMessageMap().putError(KFSConstants.GLOBAL_ERRORS, PdpKeyConstants.Format.ErrorMessages.ERROR_FORMAT_DISBURSEMENT_EXHAUSTED, campus, paymentGroup.getBank().getBankCode(), paymentGroup.getDisbursementType().getCode());
<a class="jxr_linenumber" name="517" href="#517">517</a> 
<a class="jxr_linenumber" name="518" href="#518">518</a>             <strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/impl/exception/FormatException.html">FormatException</a>(<span class="jxr_string">"No more disbursement numbers for bank code "</span> + paymentGroup.getBank().getBankCode() + <span class="jxr_string">" and disbursement type code "</span> + paymentGroup.getDisbursementType().getCode());
<a class="jxr_linenumber" name="519" href="#519">519</a>         }
<a class="jxr_linenumber" name="520" href="#520">520</a> 
<a class="jxr_linenumber" name="521" href="#521">521</a>         paymentGroup.setDisbursementNbr(disbursementNumber);
<a class="jxr_linenumber" name="522" href="#522">522</a>         range.setLastAssignedDisbNbr(disbursementNumber);
<a class="jxr_linenumber" name="523" href="#523">523</a> 
<a class="jxr_linenumber" name="524" href="#524">524</a>         <em class="jxr_comment">// Update the summary information</em>
<a class="jxr_linenumber" name="525" href="#525">525</a>         postFormatProcessSummary.setDisbursementNumber(paymentGroup, disbursementNumber.intValue());
<a class="jxr_linenumber" name="526" href="#526">526</a> 
<a class="jxr_linenumber" name="527" href="#527">527</a>         <strong class="jxr_keyword">return</strong> disbursementNumber;
<a class="jxr_linenumber" name="528" href="#528">528</a>     }
<a class="jxr_linenumber" name="529" href="#529">529</a> 
<a class="jxr_linenumber" name="530" href="#530">530</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="531" href="#531">531</a> <em class="jxr_javadoccomment">     * runs the extract process.</em>
<a class="jxr_linenumber" name="532" href="#532">532</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="533" href="#533">533</a>     <strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">void</strong> extractChecks() {
<a class="jxr_linenumber" name="534" href="#534">534</a>         LOG.debug(<span class="jxr_string">"extractChecks() started"</span>);
<a class="jxr_linenumber" name="535" href="#535">535</a> 
<a class="jxr_linenumber" name="536" href="#536">536</a>         extractPaymentService.extractChecks();
<a class="jxr_linenumber" name="537" href="#537">537</a>     }
<a class="jxr_linenumber" name="538" href="#538">538</a> 
<a class="jxr_linenumber" name="539" href="#539">539</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="540" href="#540">540</a> <em class="jxr_javadoccomment">     * @see org.kuali.kfs.pdp.service.FormatService#clearUnfinishedFormat(java.lang.Integer)</em>
<a class="jxr_linenumber" name="541" href="#541">541</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="542" href="#542">542</a>     @SuppressWarnings(<span class="jxr_string">"rawtypes"</span>)
<a class="jxr_linenumber" name="543" href="#543">543</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> clearUnfinishedFormat(Integer processId) {
<a class="jxr_linenumber" name="544" href="#544">544</a>         LOG.debug(<span class="jxr_string">"clearUnfinishedFormat() started"</span>);
<a class="jxr_linenumber" name="545" href="#545">545</a> 
<a class="jxr_linenumber" name="546" href="#546">546</a>         Map primaryKeys = <strong class="jxr_keyword">new</strong> HashMap();
<a class="jxr_linenumber" name="547" href="#547">547</a>         primaryKeys.put(PdpPropertyConstants.PaymentProcess.PAYMENT_PROCESS_ID, processId);
<a class="jxr_linenumber" name="548" href="#548">548</a>         <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">PaymentProcess</a> paymentProcess = (PaymentProcess) <strong class="jxr_keyword">this</strong>.businessObjectService.findByPrimaryKey(PaymentProcess.<strong class="jxr_keyword">class</strong>, primaryKeys);
<a class="jxr_linenumber" name="549" href="#549">549</a>         LOG.debug(<span class="jxr_string">"clearUnfinishedFormat() Process: "</span> + paymentProcess);
<a class="jxr_linenumber" name="550" href="#550">550</a> 
<a class="jxr_linenumber" name="551" href="#551">551</a>         formatPaymentDao.unmarkPaymentsForFormat(paymentProcess);
<a class="jxr_linenumber" name="552" href="#552">552</a> 
<a class="jxr_linenumber" name="553" href="#553">553</a>         endFormatProcess(paymentProcess.getCampusCode());
<a class="jxr_linenumber" name="554" href="#554">554</a>     }
<a class="jxr_linenumber" name="555" href="#555">555</a> 
<a class="jxr_linenumber" name="556" href="#556">556</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="557" href="#557">557</a> <em class="jxr_javadoccomment">     * @see org.kuali.kfs.pdp.service.FormatService#resetFormatPayments(java.lang.Integer)</em>
<a class="jxr_linenumber" name="558" href="#558">558</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="559" href="#559">559</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> resetFormatPayments(Integer processId) {
<a class="jxr_linenumber" name="560" href="#560">560</a>         LOG.debug(<span class="jxr_string">"resetFormatPayments() started"</span>);
<a class="jxr_linenumber" name="561" href="#561">561</a>         clearUnfinishedFormat(processId);
<a class="jxr_linenumber" name="562" href="#562">562</a>     }
<a class="jxr_linenumber" name="563" href="#563">563</a> 
<a class="jxr_linenumber" name="564" href="#564">564</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="565" href="#565">565</a> <em class="jxr_javadoccomment">     * @see org.kuali.kfs.pdp.service.FormatService#endFormatProcess(java.lang.String)</em>
<a class="jxr_linenumber" name="566" href="#566">566</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="567" href="#567">567</a>     @SuppressWarnings(<span class="jxr_string">"rawtypes"</span>)
<a class="jxr_linenumber" name="568" href="#568">568</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> endFormatProcess(String campus) {
<a class="jxr_linenumber" name="569" href="#569">569</a>         LOG.debug(<span class="jxr_string">"endFormatProcess() starting"</span>);
<a class="jxr_linenumber" name="570" href="#570">570</a> 
<a class="jxr_linenumber" name="571" href="#571">571</a>         Map primaryKeys = <strong class="jxr_keyword">new</strong> HashMap();
<a class="jxr_linenumber" name="572" href="#572">572</a>         primaryKeys.put(PdpPropertyConstants.PHYS_CAMPUS_PROCESS_CODE, campus);
<a class="jxr_linenumber" name="573" href="#573">573</a> 
<a class="jxr_linenumber" name="574" href="#574">574</a>         <strong class="jxr_keyword">this</strong>.businessObjectService.deleteMatching(FormatProcess.<strong class="jxr_keyword">class</strong>, primaryKeys);
<a class="jxr_linenumber" name="575" href="#575">575</a>     }
<a class="jxr_linenumber" name="576" href="#576">576</a> 
<a class="jxr_linenumber" name="577" href="#577">577</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="578" href="#578">578</a> <em class="jxr_javadoccomment">     * @see org.kuali.kfs.pdp.service.FormatService#getAllCustomerProfiles()</em>
<a class="jxr_linenumber" name="579" href="#579">579</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="580" href="#580">580</a>     <strong class="jxr_keyword">public</strong> List&lt;CustomerProfile&gt; getAllCustomerProfiles() {
<a class="jxr_linenumber" name="581" href="#581">581</a>         <strong class="jxr_keyword">if</strong> (LOG.isDebugEnabled()) {
<a class="jxr_linenumber" name="582" href="#582">582</a>             LOG.debug(<span class="jxr_string">"getAllCustomerProfiles() started"</span>);
<a class="jxr_linenumber" name="583" href="#583">583</a>         }
<a class="jxr_linenumber" name="584" href="#584">584</a>         Map&lt;String, Object&gt; criteria = <strong class="jxr_keyword">new</strong> HashMap&lt;String, Object&gt;();
<a class="jxr_linenumber" name="585" href="#585">585</a>         criteria.put(KFSPropertyConstants.ACTIVE, Boolean.TRUE);
<a class="jxr_linenumber" name="586" href="#586">586</a> 
<a class="jxr_linenumber" name="587" href="#587">587</a>         List&lt;CustomerProfile&gt; customerProfileList = (List&lt;CustomerProfile&gt;) getBusinessObjectService().findMatching(CustomerProfile.<strong class="jxr_keyword">class</strong>, criteria);
<a class="jxr_linenumber" name="588" href="#588">588</a> 
<a class="jxr_linenumber" name="589" href="#589">589</a>         DynamicCollectionComparator.sort(customerProfileList, PdpPropertyConstants.CustomerProfile.CUSTOMER_PROFILE_CHART_CODE, PdpPropertyConstants.CustomerProfile.CUSTOMER_PROFILE_UNIT_CODE, PdpPropertyConstants.CustomerProfile.CUSTOMER_PROFILE_SUB_UNIT_CODE);
<a class="jxr_linenumber" name="590" href="#590">590</a> 
<a class="jxr_linenumber" name="591" href="#591">591</a>         <strong class="jxr_keyword">return</strong> customerProfileList;
<a class="jxr_linenumber" name="592" href="#592">592</a>     }
<a class="jxr_linenumber" name="593" href="#593">593</a> 
<a class="jxr_linenumber" name="594" href="#594">594</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="595" href="#595">595</a> <em class="jxr_javadoccomment">     * @see org.kuali.kfs.pdp.service.FormatService#getAllDisbursementNumberRanges()</em>
<a class="jxr_linenumber" name="596" href="#596">596</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="597" href="#597">597</a>     <strong class="jxr_keyword">public</strong> List&lt;DisbursementNumberRange&gt; getAllDisbursementNumberRanges() {
<a class="jxr_linenumber" name="598" href="#598">598</a>         <strong class="jxr_keyword">if</strong> (LOG.isDebugEnabled()) {
<a class="jxr_linenumber" name="599" href="#599">599</a>             LOG.debug(<span class="jxr_string">"getAllDisbursementNumberRanges() started"</span>);
<a class="jxr_linenumber" name="600" href="#600">600</a>         }
<a class="jxr_linenumber" name="601" href="#601">601</a>         Map&lt;String, Object&gt; criteria = <strong class="jxr_keyword">new</strong> HashMap&lt;String, Object&gt;();
<a class="jxr_linenumber" name="602" href="#602">602</a>         criteria.put(KFSPropertyConstants.ACTIVE, Boolean.TRUE);
<a class="jxr_linenumber" name="603" href="#603">603</a> 
<a class="jxr_linenumber" name="604" href="#604">604</a>         List&lt;DisbursementNumberRange&gt; disbursementNumberRangeList = (List&lt;DisbursementNumberRange&gt;) getBusinessObjectService().findMatching(DisbursementNumberRange.<strong class="jxr_keyword">class</strong>, criteria);
<a class="jxr_linenumber" name="605" href="#605">605</a>         DynamicCollectionComparator.sort(disbursementNumberRangeList, PdpPropertyConstants.DisbursementNumberRange.DISBURSEMENT_NUMBER_RANGE_PHYS_CAMPUS_PROC_CODE, PdpPropertyConstants.DisbursementNumberRange.DISBURSEMENT_NUMBER_RANGE_TYPE_CODE);
<a class="jxr_linenumber" name="606" href="#606">606</a> 
<a class="jxr_linenumber" name="607" href="#607">607</a>         <strong class="jxr_keyword">return</strong> disbursementNumberRangeList;
<a class="jxr_linenumber" name="608" href="#608">608</a>     }
<a class="jxr_linenumber" name="609" href="#609">609</a> 
<a class="jxr_linenumber" name="610" href="#610">610</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="611" href="#611">611</a> <em class="jxr_javadoccomment">     * Given the List of disbursement number ranges for the processing campus, finds matches for the bank code and disbursement type</em>
<a class="jxr_linenumber" name="612" href="#612">612</a> <em class="jxr_javadoccomment">     * code. If more than one match is found, the range with the latest start date (before or equal to today) will be returned.</em>
<a class="jxr_linenumber" name="613" href="#613">613</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="614" href="#614">614</a> <em class="jxr_javadoccomment">     * @param ranges List of disbursement ranges to search (already filtered to processing campus, active, and start date before or</em>
<a class="jxr_linenumber" name="615" href="#615">615</a> <em class="jxr_javadoccomment">     *        equal to today)</em>
<a class="jxr_linenumber" name="616" href="#616">616</a> <em class="jxr_javadoccomment">     * @param bank bank code to find range for</em>
<a class="jxr_linenumber" name="617" href="#617">617</a> <em class="jxr_javadoccomment">     * @param disbursementTypeCode disbursement type code to find range for</em>
<a class="jxr_linenumber" name="618" href="#618">618</a> <em class="jxr_javadoccomment">     * @return found &lt;code&gt;DisbursementNumberRange&lt;/code or null if one was not found</em>
<a class="jxr_linenumber" name="619" href="#619">619</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="620" href="#620">620</a>     <strong class="jxr_keyword">protected</strong> <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">DisbursementNumberRange</a> getRange(List&lt;DisbursementNumberRange&gt; ranges, <a href="../../../../../../org/kuali/kfs/sys/KFSKeyConstants.html">Bank</a> bank, String disbursementTypeCode) {
<a class="jxr_linenumber" name="621" href="#621">621</a>         LOG.debug(<span class="jxr_string">"getRange() Looking for bank = "</span> + bank.getBankCode() + <span class="jxr_string">" and disbursement type "</span> + disbursementTypeCode);
<a class="jxr_linenumber" name="622" href="#622">622</a> 
<a class="jxr_linenumber" name="623" href="#623">623</a>         List&lt;DisbursementNumberRange&gt; rangeMatches = <strong class="jxr_keyword">new</strong> ArrayList&lt;DisbursementNumberRange&gt;();
<a class="jxr_linenumber" name="624" href="#624">624</a>         <strong class="jxr_keyword">for</strong> (DisbursementNumberRange range : ranges) {
<a class="jxr_linenumber" name="625" href="#625">625</a>             <strong class="jxr_keyword">if</strong> (range.getBank().getBankCode().equals(bank.getBankCode()) &amp;&amp; range.getDisbursementTypeCode().equals(disbursementTypeCode)) {
<a class="jxr_linenumber" name="626" href="#626">626</a>                 rangeMatches.add(range);
<a class="jxr_linenumber" name="627" href="#627">627</a>             }
<a class="jxr_linenumber" name="628" href="#628">628</a>         }
<a class="jxr_linenumber" name="629" href="#629">629</a> 
<a class="jxr_linenumber" name="630" href="#630">630</a>         <em class="jxr_comment">// if more than one match we need to take the range with the latest start date</em>
<a class="jxr_linenumber" name="631" href="#631">631</a>         <strong class="jxr_keyword">if</strong> (rangeMatches.size() &gt; 0) {
<a class="jxr_linenumber" name="632" href="#632">632</a>             <a href="../../../../../../org/kuali/kfs/pdp/PdpPropertyConstants.html">DisbursementNumberRange</a> maxStartDateRange = rangeMatches.get(0);
<a class="jxr_linenumber" name="633" href="#633">633</a>             <strong class="jxr_keyword">for</strong> (DisbursementNumberRange range : rangeMatches) {
<a class="jxr_linenumber" name="634" href="#634">634</a>                 <strong class="jxr_keyword">if</strong> (range.getDisbNbrRangeStartDt().compareTo(maxStartDateRange.getDisbNbrRangeStartDt()) &gt; 0) {
<a class="jxr_linenumber" name="635" href="#635">635</a>                     maxStartDateRange = range;
<a class="jxr_linenumber" name="636" href="#636">636</a>                 }
<a class="jxr_linenumber" name="637" href="#637">637</a>             }
<a class="jxr_linenumber" name="638" href="#638">638</a> 
<a class="jxr_linenumber" name="639" href="#639">639</a>             <strong class="jxr_keyword">return</strong> maxStartDateRange;
<a class="jxr_linenumber" name="640" href="#640">640</a>         }
<a class="jxr_linenumber" name="641" href="#641">641</a> 
<a class="jxr_linenumber" name="642" href="#642">642</a>         <strong class="jxr_keyword">return</strong> <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="643" href="#643">643</a>     }
<a class="jxr_linenumber" name="644" href="#644">644</a> 
<a class="jxr_linenumber" name="645" href="#645">645</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="646" href="#646">646</a> <em class="jxr_javadoccomment">     * This method sets the formatPaymentDao</em>
<a class="jxr_linenumber" name="647" href="#647">647</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="648" href="#648">648</a> <em class="jxr_javadoccomment">     * @param fpd</em>
<a class="jxr_linenumber" name="649" href="#649">649</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="650" href="#650">650</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setFormatPaymentDao(<a href="../../../../../../org/kuali/kfs/pdp/dataaccess/FormatPaymentDao.html">FormatPaymentDao</a> fpd) {
<a class="jxr_linenumber" name="651" href="#651">651</a>         formatPaymentDao = fpd;
<a class="jxr_linenumber" name="652" href="#652">652</a>     }
<a class="jxr_linenumber" name="653" href="#653">653</a> 
<a class="jxr_linenumber" name="654" href="#654">654</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="655" href="#655">655</a> <em class="jxr_javadoccomment">     * This method sets the glPendingTransactionService</em>
<a class="jxr_linenumber" name="656" href="#656">656</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="657" href="#657">657</a> <em class="jxr_javadoccomment">     * @param gs</em>
<a class="jxr_linenumber" name="658" href="#658">658</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="659" href="#659">659</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setGlPendingTransactionService(<a href="../../../../../../org/kuali/kfs/pdp/service/PendingTransactionService.html">PendingTransactionService</a> gs) {
<a class="jxr_linenumber" name="660" href="#660">660</a>         glPendingTransactionService = gs;
<a class="jxr_linenumber" name="661" href="#661">661</a>     }
<a class="jxr_linenumber" name="662" href="#662">662</a> 
<a class="jxr_linenumber" name="663" href="#663">663</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="664" href="#664">664</a> <em class="jxr_javadoccomment">     * This method sets the achService</em>
<a class="jxr_linenumber" name="665" href="#665">665</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="666" href="#666">666</a> <em class="jxr_javadoccomment">     * @param as</em>
<a class="jxr_linenumber" name="667" href="#667">667</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="668" href="#668">668</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setAchService(<a href="../../../../../../org/kuali/kfs/pdp/service/AchService.html">AchService</a> as) {
<a class="jxr_linenumber" name="669" href="#669">669</a>         achService = as;
<a class="jxr_linenumber" name="670" href="#670">670</a>     }
<a class="jxr_linenumber" name="671" href="#671">671</a> 
<a class="jxr_linenumber" name="672" href="#672">672</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="673" href="#673">673</a> <em class="jxr_javadoccomment">     * This method sets the processDao</em>
<a class="jxr_linenumber" name="674" href="#674">674</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="675" href="#675">675</a> <em class="jxr_javadoccomment">     * @param pd</em>
<a class="jxr_linenumber" name="676" href="#676">676</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="677" href="#677">677</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setProcessDao(<a href="../../../../../../org/kuali/kfs/pdp/dataaccess/ProcessDao.html">ProcessDao</a> pd) {
<a class="jxr_linenumber" name="678" href="#678">678</a>         processDao = pd;
<a class="jxr_linenumber" name="679" href="#679">679</a>     }
<a class="jxr_linenumber" name="680" href="#680">680</a> 
<a class="jxr_linenumber" name="681" href="#681">681</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="682" href="#682">682</a> <em class="jxr_javadoccomment">     * This method sets the paymentGroupDao</em>
<a class="jxr_linenumber" name="683" href="#683">683</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="684" href="#684">684</a> <em class="jxr_javadoccomment">     * @param pgd</em>
<a class="jxr_linenumber" name="685" href="#685">685</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="686" href="#686">686</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setPaymentGroupDao(<a href="../../../../../../org/kuali/kfs/pdp/dataaccess/PaymentGroupDao.html">PaymentGroupDao</a> pgd) {
<a class="jxr_linenumber" name="687" href="#687">687</a>         paymentGroupDao = pgd;
<a class="jxr_linenumber" name="688" href="#688">688</a>     }
<a class="jxr_linenumber" name="689" href="#689">689</a> 
<a class="jxr_linenumber" name="690" href="#690">690</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="691" href="#691">691</a> <em class="jxr_javadoccomment">     * This method sets the paymentDetailDao</em>
<a class="jxr_linenumber" name="692" href="#692">692</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="693" href="#693">693</a> <em class="jxr_javadoccomment">     * @param pdd</em>
<a class="jxr_linenumber" name="694" href="#694">694</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="695" href="#695">695</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setPaymentDetailDao(<a href="../../../../../../org/kuali/kfs/pdp/dataaccess/PaymentDetailDao.html">PaymentDetailDao</a> pdd) {
<a class="jxr_linenumber" name="696" href="#696">696</a>         paymentDetailDao = pdd;
<a class="jxr_linenumber" name="697" href="#697">697</a>     }
<a class="jxr_linenumber" name="698" href="#698">698</a> 
<a class="jxr_linenumber" name="699" href="#699">699</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="700" href="#700">700</a> <em class="jxr_javadoccomment">     * This method sets the schedulerService</em>
<a class="jxr_linenumber" name="701" href="#701">701</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="702" href="#702">702</a> <em class="jxr_javadoccomment">     * @param ss</em>
<a class="jxr_linenumber" name="703" href="#703">703</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="704" href="#704">704</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setSchedulerService(<a href="../../../../../../org/kuali/kfs/sys/batch/service/SchedulerService.html">SchedulerService</a> ss) {
<a class="jxr_linenumber" name="705" href="#705">705</a>         schedulerService = ss;
<a class="jxr_linenumber" name="706" href="#706">706</a>     }
<a class="jxr_linenumber" name="707" href="#707">707</a> 
<a class="jxr_linenumber" name="708" href="#708">708</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="709" href="#709">709</a> <em class="jxr_javadoccomment">     * This method sets the parameterService</em>
<a class="jxr_linenumber" name="710" href="#710">710</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="711" href="#711">711</a> <em class="jxr_javadoccomment">     * @param parameterService</em>
<a class="jxr_linenumber" name="712" href="#712">712</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="713" href="#713">713</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setParameterService(ParameterService parameterService) {
<a class="jxr_linenumber" name="714" href="#714">714</a>         <strong class="jxr_keyword">this</strong>.parameterService = parameterService;
<a class="jxr_linenumber" name="715" href="#715">715</a>     }
<a class="jxr_linenumber" name="716" href="#716">716</a> 
<a class="jxr_linenumber" name="717" href="#717">717</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="718" href="#718">718</a> <em class="jxr_javadoccomment">     * Gets the businessObjectService attribute. </em>
<a class="jxr_linenumber" name="719" href="#719">719</a> <em class="jxr_javadoccomment">     * @return Returns the businessObjectService.</em>
<a class="jxr_linenumber" name="720" href="#720">720</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="721" href="#721">721</a>     <strong class="jxr_keyword">public</strong> BusinessObjectService getBusinessObjectService() {
<a class="jxr_linenumber" name="722" href="#722">722</a>         <strong class="jxr_keyword">return</strong> businessObjectService;
<a class="jxr_linenumber" name="723" href="#723">723</a>     }
<a class="jxr_linenumber" name="724" href="#724">724</a>     
<a class="jxr_linenumber" name="725" href="#725">725</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="726" href="#726">726</a> <em class="jxr_javadoccomment">     * This method sets the businessObjectService</em>
<a class="jxr_linenumber" name="727" href="#727">727</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="728" href="#728">728</a> <em class="jxr_javadoccomment">     * @param bos</em>
<a class="jxr_linenumber" name="729" href="#729">729</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="730" href="#730">730</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setBusinessObjectService(BusinessObjectService bos) {
<a class="jxr_linenumber" name="731" href="#731">731</a>         <strong class="jxr_keyword">this</strong>.businessObjectService = bos;
<a class="jxr_linenumber" name="732" href="#732">732</a>     }
<a class="jxr_linenumber" name="733" href="#733">733</a> 
<a class="jxr_linenumber" name="734" href="#734">734</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="735" href="#735">735</a> <em class="jxr_javadoccomment">     * This method sets the paymentGroupService</em>
<a class="jxr_linenumber" name="736" href="#736">736</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="737" href="#737">737</a> <em class="jxr_javadoccomment">     * @param paymentGroupService</em>
<a class="jxr_linenumber" name="738" href="#738">738</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="739" href="#739">739</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setPaymentGroupService(<a href="../../../../../../org/kuali/kfs/pdp/service/PaymentGroupService.html">PaymentGroupService</a> paymentGroupService) {
<a class="jxr_linenumber" name="740" href="#740">740</a>         <strong class="jxr_keyword">this</strong>.paymentGroupService = paymentGroupService;
<a class="jxr_linenumber" name="741" href="#741">741</a>     }
<a class="jxr_linenumber" name="742" href="#742">742</a> 
<a class="jxr_linenumber" name="743" href="#743">743</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="744" href="#744">744</a> <em class="jxr_javadoccomment">     * This method sets the dateTimeService</em>
<a class="jxr_linenumber" name="745" href="#745">745</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="746" href="#746">746</a> <em class="jxr_javadoccomment">     * @param dateTimeService</em>
<a class="jxr_linenumber" name="747" href="#747">747</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="748" href="#748">748</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setDateTimeService(DateTimeService dateTimeService) {
<a class="jxr_linenumber" name="749" href="#749">749</a>         <strong class="jxr_keyword">this</strong>.dateTimeService = dateTimeService;
<a class="jxr_linenumber" name="750" href="#750">750</a>     }
<a class="jxr_linenumber" name="751" href="#751">751</a> 
<a class="jxr_linenumber" name="752" href="#752">752</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="753" href="#753">753</a> <em class="jxr_javadoccomment">     * Gets the extractPaymentService attribute.</em>
<a class="jxr_linenumber" name="754" href="#754">754</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="755" href="#755">755</a> <em class="jxr_javadoccomment">     * @return Returns the extractPaymentService.</em>
<a class="jxr_linenumber" name="756" href="#756">756</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="757" href="#757">757</a>     <strong class="jxr_keyword">protected</strong> <a href="../../../../../../org/kuali/kfs/pdp/batch/service/ExtractPaymentService.html">ExtractPaymentService</a> getExtractPaymentService() {
<a class="jxr_linenumber" name="758" href="#758">758</a>         <strong class="jxr_keyword">return</strong> extractPaymentService;
<a class="jxr_linenumber" name="759" href="#759">759</a>     }
<a class="jxr_linenumber" name="760" href="#760">760</a> 
<a class="jxr_linenumber" name="761" href="#761">761</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="762" href="#762">762</a> <em class="jxr_javadoccomment">     * Sets the extractPaymentService attribute value.</em>
<a class="jxr_linenumber" name="763" href="#763">763</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="764" href="#764">764</a> <em class="jxr_javadoccomment">     * @param extractPaymentService The extractPaymentService to set.</em>
<a class="jxr_linenumber" name="765" href="#765">765</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="766" href="#766">766</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> setExtractPaymentService(<a href="../../../../../../org/kuali/kfs/pdp/batch/service/ExtractPaymentService.html">ExtractPaymentService</a> extractPaymentService) {
<a class="jxr_linenumber" name="767" href="#767">767</a>         <strong class="jxr_keyword">this</strong>.extractPaymentService = extractPaymentService;
<a class="jxr_linenumber" name="768" href="#768">768</a>     }
<a class="jxr_linenumber" name="769" href="#769">769</a> 
<a class="jxr_linenumber" name="770" href="#770">770</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="771" href="#771">771</a> <em class="jxr_javadoccomment">     * @return Returns the personService.</em>
<a class="jxr_linenumber" name="772" href="#772">772</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="773" href="#773">773</a>     <strong class="jxr_keyword">protected</strong> PersonService&lt;Person&gt; getPersonService() {
<a class="jxr_linenumber" name="774" href="#774">774</a>         <strong class="jxr_keyword">if</strong>(personService==<strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="775" href="#775">775</a>             personService = SpringContext.getBean(PersonService.<strong class="jxr_keyword">class</strong>);
<a class="jxr_linenumber" name="776" href="#776">776</a>         }
<a class="jxr_linenumber" name="777" href="#777">777</a>         <strong class="jxr_keyword">return</strong> personService;
<a class="jxr_linenumber" name="778" href="#778">778</a>     }
<a class="jxr_linenumber" name="779" href="#779">779</a> 
<a class="jxr_linenumber" name="780" href="#780">780</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="781" href="#781">781</a> <em class="jxr_javadoccomment">     * This class holds disbursement number and noteLines info for payment group disbursement number assignment and combine checks.</em>
<a class="jxr_linenumber" name="782" href="#782">782</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="783" href="#783">783</a>     <strong class="jxr_keyword">protected</strong> <strong class="jxr_keyword">class</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/impl/FormatServiceImpl.html">PaymentInfo</a> {
<a class="jxr_linenumber" name="784" href="#784">784</a>         <strong class="jxr_keyword">public</strong> KualiInteger disbursementNumber;
<a class="jxr_linenumber" name="785" href="#785">785</a>         <strong class="jxr_keyword">public</strong> KualiInteger noteLines;
<a class="jxr_linenumber" name="786" href="#786">786</a> 
<a class="jxr_linenumber" name="787" href="#787">787</a>         <strong class="jxr_keyword">public</strong> <a href="../../../../../../org/kuali/kfs/pdp/service/impl/FormatServiceImpl.html">PaymentInfo</a>(KualiInteger disbursementNumber, KualiInteger noteLines) {
<a class="jxr_linenumber" name="788" href="#788">788</a>             <strong class="jxr_keyword">this</strong>.disbursementNumber = disbursementNumber;
<a class="jxr_linenumber" name="789" href="#789">789</a>             <strong class="jxr_keyword">this</strong>.noteLines = noteLines;
<a class="jxr_linenumber" name="790" href="#790">790</a>         }
<a class="jxr_linenumber" name="791" href="#791">791</a>     }
<a class="jxr_linenumber" name="792" href="#792">792</a> 
<a class="jxr_linenumber" name="793" href="#793">793</a> }
</pre>
<hr/><div id="footer">This page was automatically generated by <a href="http://maven.apache.org/">Maven</a></div></body>
</html>

